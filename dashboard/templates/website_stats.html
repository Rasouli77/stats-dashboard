{% extends 'base.html' %}
{% load static %}
{% block title %}
	شمارشگر
{% endblock %}
{% block meta_description %}
	شمارشگر
{% endblock %}
{% block extra_css %}
<!-- Style for Calendar, FlatPicker and Toastr -->
<link rel="stylesheet" href="{% static 'assets/vendor/libs/fullcalendar/fullcalendar.css' %}">
<link rel="stylesheet" href="{% static 'assets/vendor/libs/flatpickr/flatpickr.css' %}">
<link rel="stylesheet" href="{% static 'assets/vendor/css/pages/app-calendar.css' %}">
<link rel="stylesheet" href="{% static 'assets/vendor/libs/toastr/toastr.css' %}" />
<!-- Custom Style for FlatPicker Calendar -->
<style>
    .light-style .flatpickr-calendar {
        box-shadow: none !important;
    }
</style>
<!-- Custom Style for the Loading Overlay / Additional CSS -->
<style>
    .loading-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
    }
    .loader {
        border: 8px solid #f3f3f3;
        border-top: 8px solid #3498db;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .highcharts-credits {
        display: none;
    }

    .demo-inline-spacing > * {
        margin: 0px !important;
    }
    .box {
        height: 25vh;  
        overflow-y: auto;
    }
</style>
<!-- Chart Tool Bar -->
<style>
    .icon-bar {
        display: flex;
        gap: 12px;
        font-size: 24px;
        margin-top: 25px;
    }

    .icon-wrapper {
        position: relative;
        cursor: pointer;
        transition: color 0.3s ease;
    }

    /* Default color */
    .icon-wrapper i {
        color: #555;
        transition: color 0.3s ease;
    }

    /* Hover colors for each one */
    .bar-chart:hover i { color: #4caf50; } /* Green */
    .pie-chart:hover i { color: #ff9800; } /* Orange */
    .line-chart:hover i { color: #2196f3; } /* Blue */
    .ai:hover i { color: #9c27b0; } /* Purple */

    /* Tooltip styling */
    .icon-wrapper::after {
        content: attr(data-tooltip);
        position: absolute;
        top: -32px;
        left: 50%;
        transform: translateX(-50%);
        background: #333;
        color: #fff;
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
        opacity: 0;
        pointer-events: none;
        white-space: nowrap;
        transition: opacity 0.3s ease, transform 0.3s ease;
    }

    /* Show tooltip on hover */
    .icon-wrapper:hover::after {
        opacity: 1;
        transform: translateX(-50%) translateY(4px);
    }
</style>
<!-- AI UI -->
<style>
    /* ---------- MODAL OVERLAY ---------- */
    .ai-modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.4);
        backdrop-filter: blur(6px);
        justify-content: center;
        align-items: center;
        z-index: 1000;
        animation: fadeIn 0.4s ease forwards;
    }
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    /* ---------- MODAL BOX ---------- */
    .ai-modal-content {
        background: #1e1e2f;
        color: #fff;
        border-radius: 10px;
        width: 550px;
        max-width: 90%;
        padding: 24px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        transform: scale(0.9);
        animation: scaleUp 0.4s ease forwards;
    }
    @keyframes scaleUp {
        to { transform: scale(1); }
    }

    #aiResponse {
        height: 500px;
        overflow-y: auto;
        overflow-x: hidden;
    }

    #aiResponse {
        scrollbar-width: thin;           
        scrollbar-color: #1E1E2F #0F0F1A; 
    }

    /* Chrome, Edge, Safari */
    #aiResponse::-webkit-scrollbar {
        width: 8px;
    }

    #aiResponse::-webkit-scrollbar-track {
        background: #0F0F1A; 
    }

    #aiResponse::-webkit-scrollbar-thumb {
        background-color: #1E1E2F; 
        border-radius: 4px;
        border: 1px solid #2A2A3B; 
    }

    #aiResponse::-webkit-scrollbar-thumb:hover {
        background-color: #2E2E4A; 
    }

    /* ---------- CLOSE BUTTON ---------- */
    .ai-close {
        position: absolute;
        top: 1px;
        right: 22px;
        font-size: 26px;
        cursor: pointer;
        color: #ccc;
        transition: color 0.3s ease;
    }
    .ai-close:hover {
        color: #fff;
    }

    /* ---------- LOADING ANIMATION ---------- */
    .ai-loading {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 80px;
    }
    .ai-loading::before {
        content: '';
        width: 26px;
        height: 26px;
        border-radius: 50%;
        background: radial-gradient(circle at 30% 30%, #6c63ff, #483dff);
        animation: pulse 1.6s infinite ease-in-out;
        box-shadow: 0 0 20px rgba(108,99,255,0.6);
    }
    @keyframes pulse {
        0%, 100% { transform: scale(0.9); opacity: 0.8; box-shadow: 0 0 10px rgba(108,99,255,0.3); }
        50% { transform: scale(1.2); opacity: 1; box-shadow: 0 0 30px rgba(108,99,255,0.7); }
    }

    /* ---------- RESPONSE TEXT ---------- */
    .ai-response {
        display: none;
        font-size: 15px;
        line-height: 1.6;
        white-space: pre-wrap;
        border-top: 1px solid #333;
        margin-top: 15px;
        padding-top: 10px;
        min-height: 100px;
    }
</style>
<!-- Campaign Card Style -->
<style>
    #campaign-fill {
        background-clip: padding-box;
        border-style: solid;
        box-shadow: none;
        border-width: 1px;
        border-color: #e5e5e5;
        border-radius: 12px;
        height: 100%;
        padding: 5px;
        background-color: white;
    }
</style>
{% endblock %}
{% block content %}
<div class="loading-overlay" id="loading-overlay">
    <div class="loader"></div>
</div>
<div class="calendar-container">
    <div class="container">
        <div class="row">
            <!-- Date Picker Card -->
            <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12" style="margin-bottom: 10px;">
                <h1 style="color: #262626; font-size: 1.38rem; font-weight: 700;">گزارشات وب سایت</h1>
            </div>
            <div class="col-xl-2 col-lg-2 col-md-12 col-sm-12" style="margin-bottom: 10px;">
                <h1 style="color: #262626; font-size: 1.125rem; font-weight: 700;">گزارش بر اساس:</h1>
            </div>
            <div class="col-xl-2 col-lg-2 col-md-12 col-sm-12" style="margin-bottom: 10px;">
                <small><i class='bx bx-calendar'></i> بازه زمانی و شعب</small>
                <div class="card mt-3">
                    <div class="card-body" style="padding: 0px !important;">
                        <button type="button" class="btn btn-outline-primary w-100" data-bs-toggle="modal" data-bs-target="#dateModal" style="border: none; color: black; background-color: #ccdbf1;">
                            <i class="menu-icon tf-icons bx bx-filter"></i>
                            فیلتر
                        </button>
                    </div>
                </div>
            </div>
            <!-- Date Picker Modal -->
        <div class="modal fade" id="dateModal" tabindex="-1" aria-labelledby="dateModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="dateModalLabel">بازه زمانی گزارش</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="بستن"></button>
                    </div>
                    <div class="modal-body" style="display: flex; justify-content: center; align-items: center;">
                        <!-- Your date range picker goes here -->
                        <div id="date-range"></div>
                    </div>
                    <div class="modal-footer">
                        <button 
                            type="button" 
                            class="btn btn-primary" 
                            id="confirmDateBtn">
                            بعدی
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Branch Selector Card -->
        <!-- Branch Selector Modal -->
        <div class="modal fade" id="branchModal" tabindex="-1" aria-labelledby="branchModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="branchModalLabel">انتخاب نمودار</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="بستن"></button>
                    </div>
                    <div class="modal-body">
                        <div class="branches-grid">
                        <div class="form-check mt-2">
                            <input class="form-check-input fake-check" type="checkbox" value="1" id="traffic-check">
                            <label class="form-check-label" for="branch-{{ branch.pk }}">ورودی سایت</label>
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input fake-check" type="checkbox" value="2" id="visits-check">
                            <label class="form-check-label" for="branch-{{ branch.pk }}">بازدید سایت</label>
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input fake-check" type="checkbox" value="3" id="bounce-check">
                            <label class="form-check-label" for="branch-{{ branch.pk }}">نرخ پرش</label>
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input fake-check" type="checkbox" value="4" id="time-check">
                            <label class="form-check-label" for="branch-{{ branch.pk }}">میانگین زمان</label>
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input fake-check" type="checkbox" value="5" id="count-check">
                            <label class="form-check-label" for="branch-{{ branch.pk }}">تعداد فاکتور</label>
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input fake-check" type="checkbox" value="6" id="amount-check">
                            <label class="form-check-label" for="branch-{{ branch.pk }}">مبلغ فروش</label>
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input fake-check" type="checkbox" value="7" id="product-check">
                            <label class="form-check-label" for="branch-{{ branch.pk }}">تعداد محصولات</label>
                        </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary">قبلی</button>
                        <form action="" method="get" id="filter-form">
                            <label style="display: none;" for="start-date">از تاریخ</label>
                            <input type="text" name="start-date" id="start-date" style="display: none;">
                            <label style="display: none;" for="end-date">تا</label>
                            <input type="text" name="end-date" id="end-date" style="display: none;">
                            {% for branch in branches %}
                            <div class="form-check mt-3" style="display: none;">
                                <input class="form-check-input real-check" type="checkbox" value="{{ branch.pk }}" name="branch">
                                <label class="form-check-label" for="defaultCheck1">{{ branch.name }}</label>
                            </div>
                            {% endfor %}
                            <button class="btn btn-primary btn-md" type="submit" id="filter-proxy-button" data-bs-dismiss="modal">فیلتر</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="demo-inline-spacing mt-3">
                    <div class="tab-content px-0 pt-2">

                        <!-- AI Modal -->
                        <div id="aiModal" class="ai-modal">
                            <div class="ai-modal-content">
                                <span id="aiClose" class="ai-close">&times;</span>
                                <div id="aiLoading" class="ai-loading"></div>
                                <div id="aiResponse" class="ai-response">
                                </div>
                            </div>
                        </div>

                        <div id="traffic-container">
                            <!-- website traffic line chart -->
                            <div id="container-tools" class="icon-bar" style="display: none;">
                                <div class="icon-wrapper bar-chart" data-tooltip="Bar Chart">
                                    <i class="bx bx-bar-chart"></i>
                                </div>
                                <div class="icon-wrapper ai" data-tooltip="AI">
                                    <img src="{% static 'assets/img/icons/misc/gemini-logo.png' %}" alt="Gemini" class="gemini-icon" style="width: 24px;">
                                </div>
                            </div>
                            <div id="container" style="width: 100%; height: 400px; display: none;"></div>
                            <!-- website traffic bar chart -->
                            <div id="container-bar-chart-tools" class="icon-bar">
                                <div class="icon-wrapper line-chart" data-tooltip="Line Chart">
                                    <i class="bx bx-line-chart"></i>
                                </div>
                                <div class="icon-wrapper ai" data-tooltip="AI">
                                    <img src="{% static 'assets/img/icons/misc/gemini-logo.png' %}" alt="Gemini" class="gemini-icon" style="width: 24px;">
                                </div>
                            </div>
                            <div id="container-bar-chart" style="width: 100%; height: 400px;"></div>
                        </div>


                        <div id="visits-container">
                            <!-- website visits line chart -->
                            <div id="visits-tools" class="icon-bar" style="display: none;">
                                <div class="icon-wrapper bar-chart" data-tooltip="Bar Chart">
                                    <i class="bx bx-bar-chart"></i>
                                </div>
                                <div class="icon-wrapper ai" data-tooltip="AI">
                                    <img src="{% static 'assets/img/icons/misc/gemini-logo.png' %}" alt="Gemini" class="gemini-icon" style="width: 24px;">
                                </div>
                            </div>
                            <div id="visits" style="width: 100%; height: 400px; display: none;"></div>
                            <!-- website visits bar chart -->
                            <div id="visits-bar-chart-tools" class="icon-bar">
                                <div class="icon-wrapper line-chart" data-tooltip="Line Chart">
                                    <i class="bx bx-line-chart"></i>
                                </div>
                                <div class="icon-wrapper ai" data-tooltip="AI">
                                    <img src="{% static 'assets/img/icons/misc/gemini-logo.png' %}" alt="Gemini" class="gemini-icon" style="width: 24px;">
                                </div>
                            </div>
                            <div id="visits-bar-chart" style="width: 100%; height: 400px;"></div>
                        </div>

                        <div id="bounce-container">
                            <!-- website bounce rate line chart -->
                            <div id="bounce-tools" class="icon-bar" style="display: none;">
                                <div class="icon-wrapper bar-chart" data-tooltip="Bar Chart">
                                    <i class="bx bx-bar-chart"></i>
                                </div>
                                <div class="icon-wrapper ai" data-tooltip="AI">
                                    <img src="{% static 'assets/img/icons/misc/gemini-logo.png' %}" alt="Gemini" class="gemini-icon" style="width: 24px;">
                                </div>
                            </div>
                            <div id="bounce" style="width: 100%; height: 400px; display: none;"></div>
                            <!-- website visits bar chart -->
                            <div id="bounce-bar-chart-tools" class="icon-bar">
                                <div class="icon-wrapper line-chart" data-tooltip="Line Chart">
                                    <i class="bx bx-line-chart"></i>
                                </div>
                                <div class="icon-wrapper ai" data-tooltip="AI">
                                    <img src="{% static 'assets/img/icons/misc/gemini-logo.png' %}" alt="Gemini" class="gemini-icon" style="width: 24px;">
                                </div>
                            </div>
                            <div id="bounce-bar-chart" style="width: 100%; height: 400px;"></div>
                        </div>


                        <div id="time-container">
                            <!-- website time line chart -->
                            <div id="time-tools" class="icon-bar" style="display: none;">
                                <div class="icon-wrapper bar-chart" data-tooltip="Bar Chart">
                                    <i class="bx bx-bar-chart"></i>
                                </div>
                                <div class="icon-wrapper ai" data-tooltip="AI">
                                    <img src="{% static 'assets/img/icons/misc/gemini-logo.png' %}" alt="Gemini" class="gemini-icon" style="width: 24px;">
                                </div>
                            </div>
                            <div id="time" style="width: 100%; height: 400px; display: none;"></div>
                            <!-- website time bar chart -->
                            <div id="time-bar-chart-tools" class="icon-bar">
                                <div class="icon-wrapper line-chart" data-tooltip="Line Chart">
                                    <i class="bx bx-line-chart"></i>
                                </div>
                                <div class="icon-wrapper ai" data-tooltip="AI">
                                    <img src="{% static 'assets/img/icons/misc/gemini-logo.png' %}" alt="Gemini" class="gemini-icon" style="width: 24px;">
                                </div>
                            </div>
                            <div id="time-bar-chart" style="width: 100%; height: 400px;"></div>
                        </div>


                        <div id="count-container">
                            <!-- website count line chart -->
                            <div id="count-tools" class="icon-bar" style="display: none;">
                                <div class="icon-wrapper bar-chart" data-tooltip="Bar Chart">
                                    <i class="bx bx-bar-chart"></i>
                                </div>
                                <div class="icon-wrapper ai" data-tooltip="AI">
                                    <img src="{% static 'assets/img/icons/misc/gemini-logo.png' %}" alt="Gemini" class="gemini-icon" style="width: 24px;">
                                </div>
                            </div>
                            <div id="count" style="width: 100%; height: 400px; display: none;"></div>
                            <!-- website count bar chart -->
                            <div id="count-bar-chart-tools" class="icon-bar">
                                <div class="icon-wrapper line-chart" data-tooltip="Line Chart">
                                    <i class="bx bx-line-chart"></i>
                                </div>
                                <div class="icon-wrapper ai" data-tooltip="AI">
                                    <img src="{% static 'assets/img/icons/misc/gemini-logo.png' %}" alt="Gemini" class="gemini-icon" style="width: 24px;">
                                </div>
                            </div>
                            <div id="count-bar-chart" style="width: 100%; height: 400px;"></div>
                        </div>


                        <div id="amount-container">
                            <!-- website amount line chart -->
                            <div id="amount-tools" class="icon-bar" style="display: none;">
                                <div class="icon-wrapper bar-chart" data-tooltip="Bar Chart">
                                    <i class="bx bx-bar-chart"></i>
                                </div>
                                <div class="icon-wrapper ai" data-tooltip="AI">
                                    <img src="{% static 'assets/img/icons/misc/gemini-logo.png' %}" alt="Gemini" class="gemini-icon" style="width: 24px;">
                                </div>
                            </div>
                            <div id="amount" style="width: 100%; height: 400px; display: none;"></div>
                            <!-- website amount bar chart -->
                            <div id="amount-bar-chart-tools" class="icon-bar">
                                <div class="icon-wrapper line-chart" data-tooltip="Line Chart">
                                    <i class="bx bx-line-chart"></i>
                                </div>
                                <div class="icon-wrapper ai" data-tooltip="AI">
                                    <img src="{% static 'assets/img/icons/misc/gemini-logo.png' %}" alt="Gemini" class="gemini-icon" style="width: 24px;">
                                </div>
                            </div>
                            <div id="amount-bar-chart" style="width: 100%; height: 400px;"></div>
                        </div>


                        <div id="product-container">
                            <!-- website product line chart -->
                            <div id="product-tools" class="icon-bar" style="display: none;">
                                <div class="icon-wrapper bar-chart" data-tooltip="Bar Chart">
                                    <i class="bx bx-bar-chart"></i>
                                </div>
                                <div class="icon-wrapper ai" data-tooltip="AI">
                                    <img src="{% static 'assets/img/icons/misc/gemini-logo.png' %}" alt="Gemini" class="gemini-icon" style="width: 24px;">
                                </div>
                            </div>
                            <div id="product" style="width: 100%; height: 400px; display: none;"></div>
                            <!-- website product bar chart -->
                            <div id="product-bar-chart-tools" class="icon-bar">
                                <div class="icon-wrapper line-chart" data-tooltip="Line Chart">
                                    <i class="bx bx-line-chart"></i>
                                </div>
                                <div class="icon-wrapper ai" data-tooltip="AI">
                                    <img src="{% static 'assets/img/icons/misc/gemini-logo.png' %}" alt="Gemini" class="gemini-icon" style="width: 24px;">
                                </div>
                            </div>
                            <div id="product-bar-chart" style="width: 100%; height: 400px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" style="margin-left: 0px;">
            <div class="col-lg-3" id="holiday-container">
                <div class="card" id="holiday-card" style="background-clip: padding-box;
                border-style: solid;
                box-shadow: none;
                border-width: 1px;
                border-color: #e5e5e5;
                border-radius: 12px;
                height: 100%;  
                padding: 10px">
                    <div class="demo-inline-spacing mt-3" style="margin-bottom: 25px;">
                        <ul class="list-group list-group-timeline">
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-lg-9">
                <div class="row" id="campaign-fill">
                </div>
            </div>
        </div>
    </div><br>
</div>
<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}" style="display: none;">
{% endblock %}
{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/jalaali-js/dist/jalaali.min.js"></script>
<!-- JQuery and Toastr Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment-jalaali@0.10.4/build/moment-jalaali.min.js"></script>
<!-- Jdatetime -->
<script src="https://cdn.jsdelivr.net/npm/jalaali-js@1.2.6/dist/jalaali.min.js"></script>
<!-- Holiday Spotter -->
<script>
    const holidayDates = []
    const fridays = []
    let timelineHolidays = []
    $("#filter-form").on("submit", function (e) {
        const events = [
            "جشن نوروز/جشن سال نو",
            "شب قدر",
            "عید سعید فطر",
            "روز جمهوری اسلامی",
            "تعطیل به مناسبت عید سعید فطر",
            "جشن سیزده به در",
            "شهادت امام جعفر صادق علیه السلام",
            "ولادت امام رضا علیه السلام",
            "رحلت حضرت امام خمینی",
            "شهادت امام محمد باقر علیه السلام",
            "قیام 15 خرداد",
            "عید سعید قربان",
            "عید سعید غدیر خم",
            "تاسوعای حسینی",
            "عاشورای حسینی",
            "اربعین حسینی",
            "رحلت رسول اکرم؛شهادت امام حسن مجتبی علیه السلام",
            "شهادت امام رضا علیه السلام",
            "شهادت امام حسن عسکری علیه السلام",
            "میلاد رسول اکرم و امام جعفر صادق علیه السلام",
            "شهادت حضرت فاطمه زهرا سلام الله علیها",
            "ولادت امام علی علیه السلام و روز پدر",
            "مبعث رسول اکرم (ص)",
            "ولادت حضرت قائم عجل الله تعالی فرجه و جشن نیمه شعبان",
            "شهادت حضرت علی علیه السلام",
            "روز ملی شدن صنعت نفت ایران"
        ];
        const startDate = $("#start-date").val();
        const endDate = $("#end-date").val();
        $.ajax({
            url: "/api/holiday-spot",
            data: {
                "start-date": startDate,
                "end-date": endDate
            },
            traditional: true,
            success: function (data) {
                data.forEach(item => {
                    if (item.descriptions[0] !== 'جمعه') {
                        holidayDates.push(item.date);
                    }
                });
                data.forEach(item => {
                    if (item.descriptions[0] === 'جمعه') {
                        fridays.push(item.date);
                    }
                });
                timelineHolidays = data;
                if (timelineHolidays.length > 0) {
                    timelineHolidays.forEach(item => {
                        item.descriptions = item.descriptions.filter(i => events.includes(i));
                        if (item.descriptions.length > 1) {
                            item.descriptions.length = 1;
                        }
                    });
                }
                timelineHolidays = timelineHolidays.filter(i => i.descriptions.length > 0)
                const holidayContainer = document.querySelector("#holiday-container");
                if (timelineHolidays.length === 0) {
                    document.querySelector(".list-group-timeline").innerHTML = "<p style='display: flex; justify-content: center; align-items: center; font-weight: bold;'>مناسبتی وجود ندارد</p>";
                }
                if (timelineHolidays.length > 0) {
                    document.querySelector(".list-group-timeline").innerHTML = "";
                }
                if (timelineHolidays.length > 3) {
                    document.getElementById("holiday-card").style.height = "";
                } else {
                    document.getElementById("holiday-card").style.height = "100%";
                }
                timelineHolidays.forEach(i => {
                    if (i.descriptions.length !== 0) {
                        const rowhtml = `
                        <li class="list-group-item list-group-timeline-primary">
                            <span class="holiday-date" style="background-color: #5a8dee; border-radius: 5px; color: white; padding-left: 5px; padding-right: 5px; padding-top: 2.5px; padding-bottom: 2.5px; margin-left: 25px;">${i.date}</span>
                            <span class="description">${i.descriptions[0]}</span>
                        </li> 
                        `
                        document.querySelector(".list-group-timeline").insertAdjacentHTML("beforeend", rowhtml);
                    } 
                });
            }
        });
    });
</script>
<!-- Initial Raw JavaScript -->
<script>
    // Populate Functions
    function populateTraffic(title, x, y, t) {
        // Line Chart 
        lineChart.update({
            title: {
                text: `${title}`
                },
            xAxis: { 
                categories: y,
                },
            series: [{ name: `${title} (${Number(t).toLocaleString('fa-IR')})`, data: x}
            ],
        });
        // Bar Chart 
        barChart.update({
            title: {
                text: `${title}`
                },
            xAxis: { 
                categories: y,
                },
            series: [{ name: `${title} (${Number(t).toLocaleString('fa-IR')})`, data: x}
            ],
        });
    }

    function populateVisits(title, x, y, t) {
        // Line Chart 
        visits.update({
            title: {
                text: `${title}`
                },
            xAxis: { 
                categories: y,
                },
            series: [{ name: `${title} (${Number(t).toLocaleString('fa-IR')})`, data: x}
            ],
        });
        // Bar Chart 
        visitsBar.update({
            title: {
                text: `${title}`
                },
            xAxis: { 
                categories: y,
                },
            series: [{ name: `${title} (${Number(t).toLocaleString('fa-IR')})`, data: x}
            ],
        });
    }

    function populateBounce(title, x, y, t) {
        // Line Chart 
        bounce.update({
            title: {
                text: `${title}`
                },
            xAxis: { 
                categories: y,
                },
            series: [{ name: `${title} (${Number(t).toLocaleString('fa-IR')})`, data: x}
            ],
        });
        // Bar Chart 
        bounceBar.update({
            title: {
                text: `${title}`
                },
            xAxis: { 
                categories: y,
                },
            series: [{ name: `${title} (${Number(t).toLocaleString('fa-IR')})`, data: x}
            ],
        });
    }

    function populateTime(title, x, y, t) {
        // Line Chart 
        time.update({
            title: {
                text: `${title}`
                },
            xAxis: { 
                categories: y,
                },
            series: [{ name: `${title} (${Number(t).toLocaleString('fa-IR')})`, data: x}
            ],
        });
        // Bar Chart 
        timeBar.update({
            title: {
                text: `${title}`
                },
            xAxis: { 
                categories: y,
                },
            series: [{ name: `${title} (${Number(t).toLocaleString('fa-IR')})`, data: x}
            ],
        });
    }

    function populateCount(title, x, y, t) {
        // Line Chart 
        count.update({
            title: {
                text: `${title}`
                },
            xAxis: { 
                categories: y,
                },
            series: [{ name: `${title} (${Number(t).toLocaleString('fa-IR')})`, data: x}
            ],
        });
        // Bar Chart 
        countBar.update({
            title: {
                text: `${title}`
                },
            xAxis: { 
                categories: y,
                },
            series: [{ name: `${title} (${Number(t).toLocaleString('fa-IR')})`, data: x}
            ],
        });
    }

    function populateAmount(title, x, y, t) {
        // Line Chart 
        amount.update({
            title: {
                text: `${title}`
                },
            xAxis: { 
                categories: y,
                },
            series: [{ name: `${title} (${Number(t).toLocaleString('fa-IR')})`, data: x}
            ],
        });
        // Bar Chart 
        amountBar.update({
            title: {
                text: `${title}`
                },
            xAxis: { 
                categories: y,
                },
            series: [{ name: `${title} (${Number(t).toLocaleString('fa-IR')})`, data: x}
            ],
        });
    }

    function populateProduct(title, x, y, t) {
        // Line Chart 
        product.update({
            title: {
                text: `${title}`
                },
            xAxis: { 
                categories: y,
                },
            series: [{ name: `${title} (${Number(t).toLocaleString('fa-IR')})`, data: x}
            ],
        });
        // Bar Chart 
        productBar.update({
            title: {
                text: `${title}`
                },
            xAxis: { 
                categories: y,
                },
            series: [{ name: `${title} (${Number(t).toLocaleString('fa-IR')})`, data: x}
            ],
        });
    }

    // getJalaliDateRange returns the last 7 days
        function getJalaliDateRange() {
        const today = new Date();
        const sevenDaysAgo = new Date();
        sevenDaysAgo.setDate(today.getDate() - 7);

        function toJalaliStr(date) {
            const { jy, jm, jd } = jalaali.toJalaali(date);
            return `${jy}-${String(jm).padStart(2, "0")}-${String(jd).padStart(2, "0")}`;
        }

        const inStartDate = toJalaliStr(sevenDaysAgo);
        const inEndDate = toJalaliStr(today);

        return { inStartDate, inEndDate };
    }

    // This triggers all campaigns on page load
    document.addEventListener("DOMContentLoaded", () => {
        // The last 7 days: start and end
        const {inStartDate, inEndDate} = getJalaliDateRange();
        // This takes care of campaigns in the last 7 days
        fetch(`{% url 'invoice_counter' url_hash=request.user.profile.merchant.url_hash %}?start-date=${inStartDate}&end-date=${inEndDate}`, {
                method: 'GET',
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            document.querySelector("#campaign-fill").innerHTML = "";
            if (data.campaigns.length === 0) {
                const card = document.createElement("div");
                card.classList.add("card");
                card.classList.add("h-100");
                card.setAttribute("style", "border-radius: 12px; border-color: #e5e5e5; box-shadow: none !important; border-width: 1px; display: flex; justify-content: center; align-items: center; font-weight: bold;");
                const i = document.createElement("i");
                i.classList.add("bx");
                i.classList.add("bx-box");
                i.style.fontSize = "48px";
                const p = document.createElement("p");
                p.innerText = "هیچ کمپینی یافت نشد";
                card.appendChild(i);
                card.appendChild(p);
                document.querySelector("#campaign-fill").appendChild(card);
            } else {
                document.querySelector("#campaign-fill").innerHTML = "";
                data.campaigns.forEach(campaign => {
                    const rowhtml = `
                            <div class="col-lg-4" style="margin-top: 10px; margin-bottom: 10px;">
                            <div class="card" style="
                            background-clip: padding-box;
                            border-style: solid;
                            box-shadow: none;
                            border-width: 1px;
                            border-color: #e5e5e5;
                            background-color: #F9F9F9;
                            border-radius: 12px;
                            padding: 10px;">
                                <div class="card-header d-flex align-items-center justify-content-between">
                                    <h5 class="card-title mb-0">${campaign.campaign_name}</h5>
                                </div>
                                <div class="card-body pb-3">
                                    <ul class="p-0 m-0">
                                    <li class="d-flex align-items-center mb-3">
                                        <div class="avatar avatar-sm flex-shrink-0 me-3">
                                        <span class="avatar-initial rounded-circle bg-label-primary"><i class="bx bx-time"></i></span>
                                        </div>
                                        <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
                                        <div class="me-2">
                                            <p class="mb-0">شروع</p>
                                            <small class="text-muted">تاریخ شروع کمپین</small>
                                        </div>
                                        <div class="item-progress greg-date">${campaign.campaign_start_date}</div>
                                        </div>
                                    </li>
                                    <li class="d-flex align-items-center mb-3">
                                        <div class="avatar avatar-sm flex-shrink-0 me-3">
                                        <span class="avatar-initial rounded-circle bg-label-info"><i class="bx bx-stopwatch"></i></span>
                                        </div>
                                        <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
                                        <div class="me-2">
                                            <p class="mb-0">پایان</p>
                                            <small class="text-muted">تاریخ پایان کمپین</small>
                                        </div>
                                        <div class="item-progress greg-date">${campaign.campaign_end_date}</div>
                                        </div>
                                    </li>
                                    <li class="d-flex align-items-center mb-3">
                                        <div class="avatar avatar-sm flex-shrink-0 me-3">
                                        <span class="avatar-initial rounded-circle bg-label-danger"><i class="bx bx-tag"></i></span>
                                        </div>
                                        <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
                                        <div class="me-2">
                                            <p class="mb-0">نوع</p>
                                            <small class="text-muted">مثال: فروش و ...</small>
                                        </div>
                                        <div class="item-progress">${campaign.campaign_type}</div>
                                        </div>
                                    </li>
                                    <li class="d-flex align-items-center">
                                        <div class="avatar avatar-sm flex-shrink-0 me-3">
                                        <span class="avatar-initial rounded-circle bg-label-success"><i class="bx bx-dollar"></i></span>
                                        </div>
                                        <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
                                        <div class="me-2">
                                            <p class="mb-0">هزینه</p>
                                            <small class="text-muted">مجموع هزینه‌ها</small>
                                        </div>
                                        <div class="item-progress campaign-cost">${campaign.campaign_cost}</div>
                                        </div>
                                    </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        `
                    document.querySelector("#campaign-fill").insertAdjacentHTML("beforeend", rowhtml);
                });
            }
            
            function jalaliDateConvertor() {
                document.querySelectorAll(".greg-date").forEach(el => {
                    const gregorian = el.innerHTML.split("-");
                    const gYear = parseInt(gregorian[0]);
                    const gMonth = parseInt(gregorian[1]);
                    const gDay = parseInt(gregorian[2]);
                    const jdate = jalaali.toJalaali(gYear, gMonth, gDay);
                    el.innerText = `${jdate.jy}/${String(jdate.jm).padStart(2, '0')}/${String(jdate.jd).padStart(2, '0')}`;
                    });
            }
            document.querySelectorAll(".campaign-cost").forEach(el => {
                const cost = Number(el.innerText);
                const separatedCost = cost.toLocaleString('fa-IR');
                el.innerText = separatedCost;
            })
            setTimeout(jalaliDateConvertor, 500);
            })
            .catch(error => {
                console.error('Error:', error);
        });
        // Selected events for holiday display
        const inevents = [
            "جشن نوروز/جشن سال نو",
            "شب قدر",
            "عید سعید فطر",
            "روز جمهوری اسلامی",
            "تعطیل به مناسبت عید سعید فطر",
            "جشن سیزده به در",
            "شهادت امام جعفر صادق علیه السلام",
            "ولادت امام رضا علیه السلام",
            "رحلت حضرت امام خمینی",
            "شهادت امام محمد باقر علیه السلام",
            "قیام 15 خرداد",
            "عید سعید قربان",
            "عید سعید غدیر خم",
            "تاسوعای حسینی",
            "عاشورای حسینی",
            "اربعین حسینی",
            "رحلت رسول اکرم؛شهادت امام حسن مجتبی علیه السلام",
            "شهادت امام رضا علیه السلام",
            "شهادت امام حسن عسکری علیه السلام",
            "میلاد رسول اکرم و امام جعفر صادق علیه السلام",
            "شهادت حضرت فاطمه زهرا سلام الله علیها",
            "ولادت امام علی علیه السلام و روز پدر",
            "مبعث رسول اکرم (ص)",
            "ولادت حضرت قائم عجل الله تعالی فرجه و جشن نیمه شعبان",
            "شهادت حضرت علی علیه السلام",
            "روز ملی شدن صنعت نفت ایران"
        ];
        // Holidays in the last 7 days
        const startDate = inStartDate;
        const endDate = inEndDate;
        // Takes care of holiday display
        $.ajax({
            url: "/api/holiday-spot",
            data: {
                "start-date": startDate,
                "end-date": endDate
            },
            traditional: true,
            success: function (data) {
                data.forEach(item => {
                    if (item.descriptions[0] !== 'جمعه') {
                        holidayDates.push(item.date);
                    }
                });
                data.forEach(item => {
                    if (item.descriptions[0] === 'جمعه') {
                        fridays.push(item.date);
                    }
                });
                timelineHolidays = data;
                if (timelineHolidays.length > 0) {
                    timelineHolidays.forEach(item => {
                        item.descriptions = item.descriptions.filter(i => inevents.includes(i));
                        if (item.descriptions.length > 1) {
                            item.descriptions.length = 1;
                        }
                    });
                }
                timelineHolidays = timelineHolidays.filter(i => i.descriptions.length > 0)
                const holidayContainer = document.querySelector("#holiday-container");
                if (timelineHolidays.length === 0) {
                    document.querySelector(".list-group-timeline").innerHTML = "<p style='display: flex; justify-content: center; align-items: center; font-weight: bold;'>مناسبتی وجود ندارد</p>";
                }
                if (timelineHolidays.length > 0) {
                    document.querySelector(".list-group-timeline").innerHTML = "";
                }
                if (timelineHolidays.length > 3) {
                    document.getElementById("holiday-card").style.height = "";
                } else {
                    document.getElementById("holiday-card").style.height = "100%";
                }
                timelineHolidays.forEach(i => {
                    if (i.descriptions.length !== 0) {
                        const rowhtml = `
                        <li class="list-group-item list-group-timeline-primary">
                            <span class="holiday-date" style="background-color: #5a8dee; border-radius: 5px; color: white; padding-left: 5px; padding-right: 5px; padding-top: 2.5px; padding-bottom: 2.5px; margin-left: 25px;">${i.date}</span>
                            <span class="description">${i.descriptions[0]}</span>
                        </li> 
                        `
                        document.querySelector(".list-group-timeline").insertAdjacentHTML("beforeend", rowhtml);
                    } 
                });
            }
        });
    });
    // This triggers on page load for charts
    document.addEventListener("DOMContentLoaded", () => {
        // The last 7 days: start and end
        const {inStartDate, inEndDate} = getJalaliDateRange();
        console.log(inStartDate, inEndDate)
        // Holidays in the last 7 days
        const startDate = inStartDate;
        const endDate = inEndDate;
        // This takes care of people counting data
        fetch(`{% url 'website_stats' url_hash=request.user.profile.merchant.url_hash %}?start-date=${inStartDate}&end-date=${inEndDate}`, {
            method: 'GET',
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            console.log(data)
            const total = data.entry_totals.reduce((a, b) => a + b, 0);
            const totalAmount = data.invoice_amount.reduce((a, b) => a + b, 0);
            const totalAvgTimeSpent = data.avg_time_spent.reduce((a, b) => a + b, 0);
            const totalVisits = data.visits.reduce((a, b) => a + b, 0);
            const totalBounceRate = data.bounce_rate.reduce((a, b) => a + b, 0);
            const totalCount = data.invoice_count.reduce((a, b) => a + b, 0);
            const totalProduct = data.product_count.reduce((a, b) => a + b, 0);

            const newCategories = data.dates.map(dateStr => {
                const date = new Date(dateStr);
                return date.toLocaleDateString('fa-IR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                });
            });
            // Populate Data
            populateTraffic('ورودی سایت', data.entry_totals, newCategories, total);
            populateVisits('بازدید سایت', data.visits, newCategories, totalVisits);
            populateBounce('نرخ پرش', data.bounce_rate, newCategories, totalBounceRate);
            populateTime('میانگین زمان هر کاربر', data.avg_time_spent, newCategories, totalAvgTimeSpent);
            populateCount('تعداد فاکتور سایت', data.invoice_count, newCategories, totalCount);
            populateAmount('فروش سایت', data.invoice_amount, newCategories, totalAmount);
            populateProduct('تعداد محصول فروخته شده', data.product_count, newCategories, totalProduct);
        })
        .catch(error => {
            console.error('Error:', error);
            alert('خطا در بارگذاری داده‌ها. لطفاً دوباره تلاش کنید.');
        });
    });
</script>
<!-- AI Initialization -->
<script>
    let aiStartDate = "";
    let aiEndDate = "";
</script>
<!-- Filter -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const categories = JSON.parse('{{ dates|safe }}');  
        const entry_totals = JSON.parse('{{ entry_totals|safe }}');
        const invoice_count = JSON.parse('{{ invoice_count|safe }}');
        const invoice_amount = JSON.parse('{{ invoice_amount|safe }}');
        const invoice_product = JSON.parse('{{ product_count|safe }}');
        // Traffic Line Chart
        lineChart = Highcharts.chart('container', {
        chart: {
            type: 'line',
            backgroundColor: '#ffffff',
            borderColor: '#e5e5e5',  
            borderWidth: 1,           
            borderRadius: 12,         
            spacing: [30, 20, 30, 20],
            style: {
                fontFamily: 'Vazirmatn, sans-serif',
                fontSize: '20px'
            }
        },
        title: {
            text: "ورودی سایت",
            style: {
                fontSize: '25px',
                color: '#333',
                fontFamily: 'Vazirmatn, sans-serif',
            }
        },
        xAxis: {
            categories: categories,
            title: {
                text: "تاریخ",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        yAxis: {
            title: {
                text: "ورودی",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        tooltip: {
            backgroundColor: 'white',
            borderColor: '#ccc',
            borderRadius: 8,
            shadow: true,
            style: { fontSize: '15px' },
            shared: true, 
        },
        plotOptions: {
            series: {
                lineWidth: 3, 
                marker: {
                    enabled: true,
                    radius: 5,
                    states: { hover: { radius: 7.5 } }
                },
                states: {
                    hover: { lineWidthPlus: 1 }
                },
            }
        },
        series: [
            {   
                name: `ورودی`,
                color: "#3A86FF",
                data: []
            }
        ]
        });

        // Visits Line Chart
        visits = Highcharts.chart('visits', {
        chart: {
            type: 'line',
            backgroundColor: '#ffffff',
            borderColor: '#e5e5e5',  
            borderWidth: 1,           
            borderRadius: 12,         
            spacing: [30, 20, 30, 20],
            style: {
                fontFamily: 'Vazirmatn, sans-serif',
                fontSize: '20px'
            }
        },
        title: {
            text: "بازدید",
            style: {
                fontSize: '25px',
                color: '#333',
                fontFamily: 'Vazirmatn, sans-serif',
            }
        },
        xAxis: {
            categories: categories,
            title: {
                text: "تاریخ",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        yAxis: {
            title: {
                text: "بازدید",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        tooltip: {
            backgroundColor: 'white',
            borderColor: '#ccc',
            borderRadius: 8,
            shadow: true,
            style: { fontSize: '15px' },
            shared: true, 
        },
        plotOptions: {
            series: {
                lineWidth: 3, 
                marker: {
                    enabled: true,
                    radius: 5,
                    states: { hover: { radius: 7.5 } }
                },
                states: {
                    hover: { lineWidthPlus: 1 }
                },
            }
        },
        series: [
            {   
                name: `بازدید`,
                color: '#00B4D8',
                data: []
            }
        ]
        });

        // Bounce Line Chart
        bounce = Highcharts.chart('bounce', {
        chart: {
            type: 'line',
            backgroundColor: '#ffffff',
            borderColor: '#e5e5e5',  
            borderWidth: 1,           
            borderRadius: 12,         
            spacing: [30, 20, 30, 20],
            style: {
                fontFamily: 'Vazirmatn, sans-serif',
                fontSize: '20px'
            }
        },
        title: {
            text: "نرخ پرش",
            style: {
                fontSize: '25px',
                color: '#333',
                fontFamily: 'Vazirmatn, sans-serif',
            }
        },
        xAxis: {
            categories: categories,
            title: {
                text: "تاریخ",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        yAxis: {
            title: {
                text: "درصد ٪",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        tooltip: {
            backgroundColor: 'white',
            borderColor: '#ccc',
            borderRadius: 8,
            shadow: true,
            style: { fontSize: '15px' },
            shared: true, 
        },
        plotOptions: {
            series: {
                lineWidth: 3, 
                marker: {
                    enabled: true,
                    radius: 5,
                    states: { hover: { radius: 7.5 } }
                },
                states: {
                    hover: { lineWidthPlus: 1 }
                },
            }
        },
        series: [
            {   
                name: `درصد ٪`,
                color: '#EF233C',
                data: []
            }
        ]
        });

        // Time
        time = Highcharts.chart('time', {
        chart: {
            type: 'line',
            backgroundColor: '#ffffff',
            borderColor: '#e5e5e5',  
            borderWidth: 1,           
            borderRadius: 12,         
            spacing: [30, 20, 30, 20],
            style: {
                fontFamily: 'Vazirmatn, sans-serif',
                fontSize: '20px'
            }
        },
        title: {
            text: "میانگین زمان هر کاربر",
            style: {
                fontSize: '25px',
                color: '#333',
                fontFamily: 'Vazirmatn, sans-serif',
            }
        },
        xAxis: {
            categories: categories,
            title: {
                text: "تاریخ",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        yAxis: {
            title: {
                text: 'ثانیه',
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        tooltip: {
            backgroundColor: 'white',
            borderColor: '#ccc',
            borderRadius: 8,
            shadow: true,
            style: { fontSize: '15px' },
            shared: true, 
        },
        plotOptions: {
            series: {
                lineWidth: 3, 
                marker: {
                    enabled: true,
                    radius: 5,
                    states: { hover: { radius: 7.5 } }
                },
                states: {
                    hover: { lineWidthPlus: 1 }
                },
            }
        },
        series: [
            {   
                name: 'ثانیه',
                color: '#7209B7',
                data: []
            }
        ]
        });

        // Count
        count = Highcharts.chart('count', {
        chart: {
            type: 'line',
            backgroundColor: '#ffffff',
            borderColor: '#e5e5e5',  
            borderWidth: 1,           
            borderRadius: 12,         
            spacing: [30, 20, 30, 20],
            style: {
                fontFamily: 'Vazirmatn, sans-serif',
                fontSize: '20px'
            }
        },
        title: {
            text: "تعداد فاکتور",
            style: {
                fontSize: '25px',
                color: '#333',
                fontFamily: 'Vazirmatn, sans-serif',
            }
        },
        xAxis: {
            categories: categories,
            title: {
                text: "تاریخ",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        yAxis: {
            title: {
                text: "تعداد",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        tooltip: {
            backgroundColor: 'white',
            borderColor: '#ccc',
            borderRadius: 8,
            shadow: true,
            style: { fontSize: '15px' },
            shared: true, 
        },
        plotOptions: {
            series: {
                lineWidth: 3, 
                marker: {
                    enabled: true,
                    radius: 5,
                    states: { hover: { radius: 7.5 } }
                },
                states: {
                    hover: { lineWidthPlus: 1 }
                },
            }
        },
        series: [
            {   
                name: `تعداد`,
                color: '#FB8500',
                data: []
            }
        ]
        });

        // Amount
        amount = Highcharts.chart('amount', {
        chart: {
            type: 'line',
            backgroundColor: '#ffffff',
            borderColor: '#e5e5e5',  
            borderWidth: 1,           
            borderRadius: 12,         
            spacing: [30, 20, 30, 20],
            style: {
                fontFamily: 'Vazirmatn, sans-serif',
                fontSize: '20px'
            }
        },
        title: {
            text: "فروش فاکتور",
            style: {
                fontSize: '25px',
                color: '#333',
                fontFamily: 'Vazirmatn, sans-serif',
            }
        },
        xAxis: {
            categories: categories,
            title: {
                text: "تاریخ",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        yAxis: {
            title: {
                text: "تومان",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        tooltip: {
            backgroundColor: 'white',
            borderColor: '#ccc',
            borderRadius: 8,
            shadow: true,
            style: { fontSize: '15px' },
            shared: true, 
        },
        plotOptions: {
            series: {
                lineWidth: 3, 
                marker: {
                    enabled: true,
                    radius: 5,
                    states: { hover: { radius: 7.5 } }
                },
                states: {
                    hover: { lineWidthPlus: 1 }
                },
            }
        },
        series: [
            {   
                name: `تومان`,
                color: '#2EC4B6',
                data: []
            }
        ]
        });

        // Products
        product = Highcharts.chart('product', {
        chart: {
            type: 'line',
            backgroundColor: '#ffffff',
            borderColor: '#e5e5e5',  
            borderWidth: 1,           
            borderRadius: 12,         
            spacing: [30, 20, 30, 20],
            style: {
                fontFamily: 'Vazirmatn, sans-serif',
                fontSize: '20px'
            }
        },
        title: {
            text: "تعداد محصول",
            style: {
                fontSize: '25px',
                color: '#333',
                fontFamily: 'Vazirmatn, sans-serif',
            }
        },
        xAxis: {
            categories: categories,
            title: {
                text: "تاریخ",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        yAxis: {
            title: {
                text: "تعداد",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        tooltip: {
            backgroundColor: 'white',
            borderColor: '#ccc',
            borderRadius: 8,
            shadow: true,
            style: { fontSize: '15px' },
            shared: true, 
        },
        plotOptions: {
            series: {
                lineWidth: 3, 
                marker: {
                    enabled: true,
                    radius: 5,
                    states: { hover: { radius: 7.5 } }
                },
                states: {
                    hover: { lineWidthPlus: 1 }
                },
            }
        },
        series: [
            {   
                name: `تعداد`,
                color: '#4361EE',
                data: []
            }
        ]
        });

        // Traffic Bar Chart
        barChart = Highcharts.chart('container-bar-chart', {
        chart: {
            type: 'column',
            backgroundColor: '#ffffff',
            borderColor: '#e5e5e5',  
            borderWidth: 1,           
            borderRadius: 12,         
            spacing: [30, 20, 30, 20],
            style: {
                fontFamily: 'Vazirmatn, sans-serif',
                fontSize: '20px'
            }
        },
        title: {
            text: "ورودی سایت",
            style: {
                fontSize: '25px',
                color: '#333',
                fontFamily: 'Vazirmatn, sans-serif',
            }
        },
        xAxis: {
            categories: categories,
            title: {
                text: "تاریخ",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        yAxis: {
            title: {
                text: "ورودی",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        tooltip: {
            backgroundColor: 'white',
            borderColor: '#ccc',
            borderRadius: 8,
            shadow: true,
            style: { fontSize: '15px' },
            shared: true, 
        },
        plotOptions: {
            series: {
                lineWidth: 3, 
                marker: {
                    enabled: true,
                    radius: 5,
                    states: { hover: { radius: 7.5 } }
                },
                states: {
                    hover: { lineWidthPlus: 1 }
                },
            }
        },
        series: [
            {   
                name: `ورودی`,
                color: "#3A86FF",
                data: []
            }
        ]
        });

        // Visits Bar Chart
        visitsBar = Highcharts.chart('visits-bar-chart', {
        chart: {
            type: 'column',
            backgroundColor: '#ffffff',
            borderColor: '#e5e5e5',  
            borderWidth: 1,           
            borderRadius: 12,         
            spacing: [30, 20, 30, 20],
            style: {
                fontFamily: 'Vazirmatn, sans-serif',
                fontSize: '20px'
            }
        },
        title: {
            text: "بازدید سایت",
            style: {
                fontSize: '25px',
                color: '#333',
                fontFamily: 'Vazirmatn, sans-serif',
            }
        },
        xAxis: {
            categories: categories,
            title: {
                text: "تاریخ",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        yAxis: {
            title: {
                text: "بازدید",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        tooltip: {
            backgroundColor: 'white',
            borderColor: '#ccc',
            borderRadius: 8,
            shadow: true,
            style: { fontSize: '15px' },
            shared: true, 
        },
        plotOptions: {
            series: {
                lineWidth: 3, 
                marker: {
                    enabled: true,
                    radius: 5,
                    states: { hover: { radius: 7.5 } }
                },
                states: {
                    hover: { lineWidthPlus: 1 }
                },
            }
        },
        series: [
            {   
                name: `بازدید`,
                color: '#00B4D8',
                data: []
            }
        ]
        });

        // Bounce Bar Chart
        bounceBar = Highcharts.chart('bounce-bar-chart', {
        chart: {
            type: 'column',
            backgroundColor: '#ffffff',
            borderColor: '#e5e5e5',  
            borderWidth: 1,           
            borderRadius: 12,         
            spacing: [30, 20, 30, 20],
            style: {
                fontFamily: 'Vazirmatn, sans-serif',
                fontSize: '20px'
            }
        },
        title: {
            text: "نرخ پرش سایت",
            style: {
                fontSize: '25px',
                color: '#333',
                fontFamily: 'Vazirmatn, sans-serif',
            }
        },
        xAxis: {
            categories: categories,
            title: {
                text: "تاریخ",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        yAxis: {
            title: {
                text: "درصد ٪",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        tooltip: {
            backgroundColor: 'white',
            borderColor: '#ccc',
            borderRadius: 8,
            shadow: true,
            style: { fontSize: '15px' },
            shared: true, 
        },
        plotOptions: {
            series: {
                lineWidth: 3, 
                marker: {
                    enabled: true,
                    radius: 5,
                    states: { hover: { radius: 7.5 } }
                },
                states: {
                    hover: { lineWidthPlus: 1 }
                },
            }
        },
        series: [
            {   
                name: `درصد ٪`,
                color: '#EF233C',
                data: []
            }
        ]
        });

        // Time Bar Chart
        timeBar = Highcharts.chart('time-bar-chart', {
        chart: {
            type: 'column',
            backgroundColor: '#ffffff',
            borderColor: '#e5e5e5',  
            borderWidth: 1,           
            borderRadius: 12,         
            spacing: [30, 20, 30, 20],
            style: {
                fontFamily: 'Vazirmatn, sans-serif',
                fontSize: '20px'
            }
        },
        title: {
            text: "میانگین زمان هر کاربر",
            style: {
                fontSize: '25px',
                color: '#333',
                fontFamily: 'Vazirmatn, sans-serif',
            }
        },
        xAxis: {
            categories: categories,
            title: {
                text: "تاریخ",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        yAxis: {
            title: {
                text: "ثانیه",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        tooltip: {
            backgroundColor: 'white',
            borderColor: '#ccc',
            borderRadius: 8,
            shadow: true,
            style: { fontSize: '15px' },
            shared: true, 
        },
        plotOptions: {
            series: {
                lineWidth: 3, 
                marker: {
                    enabled: true,
                    radius: 5,
                    states: { hover: { radius: 7.5 } }
                },
                states: {
                    hover: { lineWidthPlus: 1 }
                },
            }
        },
        series: [
            {   
                name: `ثانیه`,
                color: '#7209B7',
                data: []
            }
        ]
        });

        // Count Bar Chart
        countBar = Highcharts.chart('count-bar-chart', {
        chart: {
            type: 'column',
            backgroundColor: '#ffffff',
            borderColor: '#e5e5e5',  
            borderWidth: 1,           
            borderRadius: 12,         
            spacing: [30, 20, 30, 20],
            style: {
                fontFamily: 'Vazirmatn, sans-serif',
                fontSize: '20px'
            }
        },
        title: {
            text: "تعداد فاکتور سایت",
            style: {
                fontSize: '25px',
                color: '#333',
                fontFamily: 'Vazirmatn, sans-serif',
            }
        },
        xAxis: {
            categories: categories,
            title: {
                text: "تاریخ",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        yAxis: {
            title: {
                text: "تعداد",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        tooltip: {
            backgroundColor: 'white',
            borderColor: '#ccc',
            borderRadius: 8,
            shadow: true,
            style: { fontSize: '15px' },
            shared: true, 
        },
        plotOptions: {
            series: {
                lineWidth: 3, 
                marker: {
                    enabled: true,
                    radius: 5,
                    states: { hover: { radius: 7.5 } }
                },
                states: {
                    hover: { lineWidthPlus: 1 }
                },
            }
        },
        series: [
            {   
                name: `تعداد`,
                color: '#FB8500',
                data: []
            }
        ]
        });

        // Amount Bar Chart
        amountBar = Highcharts.chart('amount-bar-chart', {
        chart: {
            type: 'column',
            backgroundColor: '#ffffff',
            borderColor: '#e5e5e5',  
            borderWidth: 1,           
            borderRadius: 12,         
            spacing: [30, 20, 30, 20],
            style: {
                fontFamily: 'Vazirmatn, sans-serif',
                fontSize: '20px'
            }
        },
        title: {
            text: "فروش سایت",
            style: {
                fontSize: '25px',
                color: '#333',
                fontFamily: 'Vazirmatn, sans-serif',
            }
        },
        xAxis: {
            categories: categories,
            title: {
                text: "تاریخ",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        yAxis: {
            title: {
                text: "تومان",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        tooltip: {
            backgroundColor: 'white',
            borderColor: '#ccc',
            borderRadius: 8,
            shadow: true,
            style: { fontSize: '15px' },
            shared: true, 
        },
        plotOptions: {
            series: {
                lineWidth: 3, 
                marker: {
                    enabled: true,
                    radius: 5,
                    states: { hover: { radius: 7.5 } }
                },
                states: {
                    hover: { lineWidthPlus: 1 }
                },
            }
        },
        series: [
            {   
                name: `تومان`,
                color: '#2EC4B6',
                data: []
            }
        ]
        });

        // Product Bar Chart
        productBar = Highcharts.chart('product-bar-chart', {
        chart: {
            type: 'column',
            backgroundColor: '#ffffff',
            borderColor: '#e5e5e5',  
            borderWidth: 1,           
            borderRadius: 12,         
            spacing: [30, 20, 30, 20],
            style: {
                fontFamily: 'Vazirmatn, sans-serif',
                fontSize: '20px'
            }
        },
        title: {
            text: "محصولات فروخته شده",
            style: {
                fontSize: '25px',
                color: '#333',
                fontFamily: 'Vazirmatn, sans-serif',
            }
        },
        xAxis: {
            categories: categories,
            title: {
                text: "تاریخ",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        yAxis: {
            title: {
                text: "تعداد",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold',
                    fontFamily: 'Vazirmatn, sans-serif',
                }
            }
        },
        tooltip: {
            backgroundColor: 'white',
            borderColor: '#ccc',
            borderRadius: 8,
            shadow: true,
            style: { fontSize: '15px' },
            shared: true, 
        },
        plotOptions: {
            series: {
                lineWidth: 3, 
                marker: {
                    enabled: true,
                    radius: 5,
                    states: { hover: { radius: 7.5 } }
                },
                states: {
                    hover: { lineWidthPlus: 1 }
                },
            }
        },
        series: [
            {   
                name: `تعداد`,
                color: '#4361EE',
                data: []
            }
        ]
        });

        document.getElementById('filter-form').addEventListener('submit', function(event) {
            event.preventDefault(); 
            const form = this;
            const formData = new FormData(form);
            const queryString = new URLSearchParams(formData).toString();
            console.log(queryString)
            const params = new URLSearchParams(formData);
            aiStartDate = params.get("start-date");
            aiEndDate = params.get("end-date");
            const loadingOverlay = document.getElementById('loading-overlay');
            loadingOverlay.style.display = 'flex';
            fetch(`{% url 'invoice_counter' url_hash=request.user.profile.merchant.url_hash %}?${queryString}`, {
                method: 'GET',
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
                })
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                }).then(data => {
                document.querySelector("#campaign-fill").innerHTML = "";
                if (data.campaigns.length === 0) {
                    const card = document.createElement("div");
                    card.classList.add("card");
                    card.classList.add("h-100");
                    card.setAttribute("style", "border-radius: 12px; border-color: #e5e5e5; box-shadow: none !important; border-width: 1px; display: flex; justify-content: center; align-items: center; font-weight: bold;");
                    const i = document.createElement("i");
                    i.classList.add("bx");
                    i.classList.add("bx-box");
                    i.style.fontSize = "48px";
                    const p = document.createElement("p");
                    p.innerText = "هیچ کمپینی یافت نشد";
                    card.appendChild(i);
                    card.appendChild(p);
                    document.querySelector("#campaign-fill").appendChild(card);
                } else {
                    document.querySelector("#campaign-fill").innerHTML = "";
                    data.campaigns.forEach(campaign => {
                        const rowhtml = `
                                <div class="col-lg-4" style="margin-top: 10px; margin-bottom: 10px;">
                                <div class="card" style="
                                background-clip: padding-box;
                                border-style: solid;
                                box-shadow: none;
                                border-width: 1px;
                                border-color: #e5e5e5;
                                background-color: #F9F9F9;
                                border-radius: 12px;
                                padding: 10px;">
                                    <div class="card-header d-flex align-items-center justify-content-between">
                                        <h5 class="card-title mb-0">${campaign.campaign_name}</h5>
                                    </div>
                                    <div class="card-body pb-3">
                                        <ul class="p-0 m-0">
                                        <li class="d-flex align-items-center mb-3">
                                            <div class="avatar avatar-sm flex-shrink-0 me-3">
                                            <span class="avatar-initial rounded-circle bg-label-primary"><i class="bx bx-time"></i></span>
                                            </div>
                                            <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
                                            <div class="me-2">
                                                <p class="mb-0">شروع</p>
                                                <small class="text-muted">تاریخ شروع کمپین</small>
                                            </div>
                                            <div class="item-progress greg-date">${campaign.campaign_start_date}</div>
                                            </div>
                                        </li>
                                        <li class="d-flex align-items-center mb-3">
                                            <div class="avatar avatar-sm flex-shrink-0 me-3">
                                            <span class="avatar-initial rounded-circle bg-label-info"><i class="bx bx-stopwatch"></i></span>
                                            </div>
                                            <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
                                            <div class="me-2">
                                                <p class="mb-0">پایان</p>
                                                <small class="text-muted">تاریخ پایان کمپین</small>
                                            </div>
                                            <div class="item-progress greg-date">${campaign.campaign_end_date}</div>
                                            </div>
                                        </li>
                                        <li class="d-flex align-items-center mb-3">
                                            <div class="avatar avatar-sm flex-shrink-0 me-3">
                                            <span class="avatar-initial rounded-circle bg-label-danger"><i class="bx bx-tag"></i></span>
                                            </div>
                                            <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
                                            <div class="me-2">
                                                <p class="mb-0">نوع</p>
                                                <small class="text-muted">مثال: فروش و ...</small>
                                            </div>
                                            <div class="item-progress">${campaign.campaign_type}</div>
                                            </div>
                                        </li>
                                        <li class="d-flex align-items-center">
                                            <div class="avatar avatar-sm flex-shrink-0 me-3">
                                            <span class="avatar-initial rounded-circle bg-label-success"><i class="bx bx-dollar"></i></span>
                                            </div>
                                            <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
                                            <div class="me-2">
                                                <p class="mb-0">هزینه</p>
                                                <small class="text-muted">مجموع هزینه‌ها</small>
                                            </div>
                                            <div class="item-progress campaign-cost">${campaign.campaign_cost}</div>
                                            </div>
                                        </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            `
                        document.querySelector("#campaign-fill").insertAdjacentHTML("beforeend", rowhtml);
                    });
                }
            });
            fetch(`{% url 'website_stats' url_hash=request.user.profile.merchant.url_hash %}?${queryString}`, {
                method: 'GET',
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            })
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok');
                return response.json();
            })
            .then(data => {
                // Overall Category Update
                const total = data.entry_totals.reduce((a, b) => a + b, 0);
                const totalAmount = data.invoice_amount.reduce((a, b) => a + b, 0);
                const totalAvgTimeSpent = data.avg_time_spent.reduce((a, b) => a + b, 0);
                const totalVisits = data.visits.reduce((a, b) => a + b, 0);
                const totalBounceRate = data.bounce_rate.reduce((a, b) => a + b, 0);
                const totalCount = data.invoice_count.reduce((a, b) => a + b, 0);
                const totalProduct = data.product_count.reduce((a, b) => a + b, 0);
                const categories = data.dates.map(dateStr => {
                const date = new Date(dateStr);
                return date.toLocaleDateString('fa-IR', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit'
                    });
                });
                populateTraffic('ورودی سایت', data.entry_totals, categories, total);
                populateVisits('بازدید سایت', data.visits, categories, totalVisits);
                populateBounce('نرخ پرش', data.bounce_rate, categories, totalBounceRate);
                populateTime('میانگین زمان هر کاربر', data.avg_time_spent, categories, totalAvgTimeSpent);
                populateCount('تعداد فاکتور سایت', data.invoice_count, categories, totalCount);
                populateAmount('فروش سایت', data.invoice_amount, categories, totalAmount);
                populateProduct('تعداد محصول فروخته شده', data.product_count, categories, totalProduct);
                loadingOverlay.style.display = 'none';
            })
            .catch(error => {
                console.error('Error:', error);
                loadingOverlay.style.display = 'none';
                alert('خطا در بارگذاری داده‌ها. لطفاً دوباره تلاش کنید.');
            });
        });
    });
</script>
<!-- Select All Data Check -->
<script>
document.querySelectorAll('.fake-check').forEach(i => {
    i.checked = true;
}); 
</script>
<!-- Select/ Display Checks -->
<script>
    // Check Boxes
    const trafficheck = document.getElementById("traffic-check");
    const visitsCheck = document.getElementById("visits-check");
    const bounceCheck = document.getElementById("bounce-check");
    const timeCheck = document.getElementById("time-check");
    const countCheck = document.getElementById("count-check");
    const amountCheck = document.getElementById("amount-check");
    const productCheck = document.getElementById("product-check");
    // Containers
    const trafficContainer = document.getElementById("traffic-container");
    const visitsContainer = document.getElementById("visits-container");
    const bounceContainer = document.getElementById("bounce-container");
    const timeContainer = document.getElementById("time-container");
    const countContainer = document.getElementById("count-container");
    const amountContainer = document.getElementById("amount-container");
    const productContainer = document.getElementById("product-container");

    function displayToggle(checkbox, container) {
        checkbox.addEventListener("change", () => {
            if (checkbox.checked === true) {
                container.style.display = '';
            } else {
                container.style.display = 'none';
            }
        });
    }
    displayToggle(trafficheck, trafficContainer);
    displayToggle(visitsCheck, visitsContainer);
    displayToggle(bounceCheck, bounceContainer);
    displayToggle(timeCheck, timeContainer);
    displayToggle(countCheck, countContainer);
    displayToggle(amountCheck, amountContainer);
    displayToggle(productCheck, productContainer);
</script>
<!-- Display Toggles -->
<script>
    // Elements

    // Chart Toggles
    // Bar Buttons
    const containerToolsBar = document.querySelector("#container-tools .bar-chart");
    const visitsToolsBar = document.querySelector("#visits-tools .bar-chart");
    const bounceToolsBar = document.querySelector("#bounce-tools .bar-chart");
    const timeToolsBar = document.querySelector("#time-tools .bar-chart");
    const countToolsBar = document.querySelector("#count-tools .bar-chart");
    const amountToolsBar = document.querySelector("#amount-tools .bar-chart");
    const productToolsBar = document.querySelector("#product-tools .bar-chart");
    // Line Buttons
    const containerBarChartToolsLine = document.querySelector("#container-bar-chart-tools .line-chart");
    const visitsBarChartToolsLine = document.querySelector("#visits-bar-chart-tools .line-chart");
    const bounceBarChartToolsLine = document.querySelector("#bounce-bar-chart-tools .line-chart");
    const timeBarChartToolsLine = document.querySelector("#time-bar-chart-tools .line-chart");
    const countBarChartToolsLine = document.querySelector("#count-bar-chart-tools .line-chart");
    const amountBarChartToolsLine = document.querySelector("#amount-bar-chart-tools .line-chart");
    const productBarChartToolsLine = document.querySelector("#product-bar-chart-tools .line-chart");

    // Charts
    // Line Charts
    const containerLine = document.querySelector("#container");
    const visitsLine = document.querySelector("#visits");
    const bounceLine = document.querySelector("#bounce");
    const timeLine = document.querySelector("#time");
    const countLine = document.querySelector("#count");
    const amountLine = document.querySelector("#amount");
    const productLine = document.querySelector("#product");
    // Bar Charts
    const containerBarChart = document.querySelector("#container-bar-chart");
    const visitsBarChart = document.querySelector("#visits-bar-chart");
    const bounceBarChart = document.querySelector("#bounce-bar-chart");
    const timeBarChart = document.querySelector("#time-bar-chart");
    const countBarChart = document.querySelector("#count-bar-chart");
    const amountBarChart = document.querySelector("#amount-bar-chart");
    const productBarChart = document.querySelector("#product-bar-chart");

    // Tools
    // Bar Chart Tools
    const containerBarChartTools = document.querySelector("#container-bar-chart-tools");
    const visitsBarChartTools = document.querySelector("#visits-bar-chart-tools");
    const bounceBarChartTools = document.querySelector("#bounce-bar-chart-tools");
    const timeBarChartTools = document.querySelector("#time-bar-chart-tools");
    const countBarChartTools = document.querySelector("#count-bar-chart-tools");
    const amountBarChartTools = document.querySelector("#amount-bar-chart-tools");
    const productBarChartTools = document.querySelector("#product-bar-chart-tools");
    // Line Chart Tools
    const containerTools = document.querySelector("#container-tools");
    const visitsTools = document.querySelector("#visits-tools");
    const bounceTools = document.querySelector("#bounce-tools");
    const timeTools = document.querySelector("#time-tools");
    const countTools = document.querySelector("#count-tools");
    const amountTools = document.querySelector("#amount-tools");
    const productTools = document.querySelector("#product-tools");

    // Chart Button Functionalities
    function toggleChartTypes(btnToClick, lineTools, lineChart, barTools, barChart, show_bar) {
        btnToClick.addEventListener("click", () => {
            if (show_bar === true) {
                barTools.style.display = '';
                barChart.style.display = '';
                lineTools.style.display = 'none';
                lineChart.style.display = 'none';
            } else {
                barTools.style.display = 'none';
                barChart.style.display = 'none';
                lineTools.style.display = '';
                lineChart.style.display = '';
            }
        });
    }

    // traffic
    toggleChartTypes(containerBarChartToolsLine, containerLine, containerTools, containerBarChart, containerBarChartTools, false);
    toggleChartTypes(containerToolsBar, containerLine, containerTools, containerBarChart, containerBarChartTools, true);

    // visits
    toggleChartTypes(visitsBarChartToolsLine, visitsLine, visitsTools, visitsBarChart, visitsBarChartTools, false);
    toggleChartTypes(visitsToolsBar, visitsLine, visitsTools, visitsBarChart, visitsBarChartTools, true);

    // bounce
    toggleChartTypes(bounceBarChartToolsLine, bounceLine, bounceTools, bounceBarChart, bounceBarChartTools, false);
    toggleChartTypes(bounceToolsBar, bounceLine, bounceTools, bounceBarChart, bounceBarChartTools, true);

    // time
    toggleChartTypes(timeBarChartToolsLine, timeLine, timeTools, timeBarChart, timeBarChartTools, false);
    toggleChartTypes(timeToolsBar, timeLine, timeTools, timeBarChart, timeBarChartTools, true);

    // count
    toggleChartTypes(countBarChartToolsLine, countLine, countTools, countBarChart, countBarChartTools, false);
    toggleChartTypes(countToolsBar, countLine, countTools, countBarChart, countBarChartTools, true);

    // amount
    toggleChartTypes(amountBarChartToolsLine, amountLine, amountTools, amountBarChart, amountBarChartTools, false);
    toggleChartTypes(amountToolsBar, amountLine, amountTools, amountBarChart, amountBarChartTools, true);

    // product
    toggleChartTypes(productBarChartToolsLine, productLine, productTools, productBarChart, productBarChartTools, false);
    toggleChartTypes(productToolsBar, productLine, productTools, productBarChart, productBarChartTools, true);


    // containerBarChartToolsLine.addEventListener("click", () => { // the line icon in the bar chart tools
    //     containerLine.style.display = ''; // line chart
    //     containerTools.style.display = ''; // line chart tools
    //     containerBarChart.style.display = 'none'; // bar chart
    //     containerBarChartTools.style.display = 'none'; // bar chart tools
    // });
    
    // containerToolsBar.addEventListener("click", () => { // the bar icon in the line chart tools
    //     containerLine.style.display = 'none';
    //     containerTools.style.display = 'none';
    //     containerBarChart.style.display = '';
    //     containerBarChartTools.style.display = '';
    // });


    
</script>
<!-- HighChart JS -->
<script src="{% static 'assets/js/highcharts.js' %}"></script>
<script src="{% static 'assets/js/exporting.js' %}"></script>
<script src="{% static 'assets/js/export-data.js' %}"></script>
<script src="{% static 'assets/js/accessibility.js' %}"></script>
<!-- FlatPicker JS (Calendar) -->
<script src="{% static 'assets/vendor/libs/jdate/jdate.js' %}"></script>
<script src="{% static 'assets/vendor/libs/flatpickr/flatpickr-jdate.js' %}"></script>
<script src="{% static 'assets/vendor/libs/moment/moment.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/moment-jalaali/build/moment-jalaali.js"></script>
<script>
    moment.loadPersian({usePersianDigits: false});
</script>
<script src="{% static 'assets/vendor/libs/flatpickr/l10n/fa-jdate.js' %}"></script>
<script src="{% static 'assets/js/app-calendar-events.js' %}"></script>
<script src="{% static 'assets/js/app-calendar.js' %}"></script>
<!-- FlatPicker (JS Calendar) Persian Configuration / Form Checks -->
<script src="{% static 'assets/js/persian-flatpicker-and-form-checks.js' %}"></script>
<!-- Gregorian Jalali Conversion Raw JavaScript -->
<script src="{% static 'assets/js/campaign-gregorian-to-jalali-date-convert.js' %}"></script>
<!-- Sweet Alert CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!-- Flatpickr Initial Date Range -->
<script src="{% static 'assets/js/flatpickr-initial-date-range.js' %}"></script>
 <!-- Date and Branch Modal Configuration -->
<script>
    document.getElementById("confirmDateBtn").addEventListener("click", function () {
    // Close the date modal
    var dateModal = bootstrap.Modal.getInstance(document.getElementById("dateModal"));
    dateModal.hide();

    // When it's fully hidden, open the branch modal
    document.getElementById("dateModal").addEventListener("hidden.bs.modal", function () {
        var branchModal = new bootstrap.Modal(document.getElementById("branchModal"));
        branchModal.show();
    }, { once: true });
    });

    document.querySelector(".btn-secondary").addEventListener("click", function () {
    // Close the date modal
    var dateModal = bootstrap.Modal.getInstance(document.getElementById("branchModal"));
    dateModal.hide();

    // When it's fully hidden, open the date modal
    document.getElementById("branchModal").addEventListener("hidden.bs.modal", function () {
        var branchModal = new bootstrap.Modal(document.getElementById("dateModal"));
        branchModal.show();
    }, { once: true });
    });
</script>
<!-- AI Buttons -->
<script src="{% static 'assets/js/ai-website.js' %}"></script>
{% endblock %}




