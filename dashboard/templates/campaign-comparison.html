{% extends 'base.html' %}
{% load static %}
{% block title %}
    مقایسه و تحلیل کمپین ها
{% endblock %}
{% block meta_description %}
    مقایسه و تحلیل کمپین ها
{% endblock %}
{% block extra_css %}
<!-- Style for Calendar, FlatPicker and Toastr -->
<link rel="stylesheet" href="{% static 'assets/vendor/libs/fullcalendar/fullcalendar.css' %}">
<link rel="stylesheet" href="{% static 'assets/vendor/libs/flatpickr/flatpickr.css' %}">
<link rel="stylesheet" href="{% static 'assets/vendor/css/pages/app-calendar.css' %}">
<!-- Shepherd -->
<link rel="stylesheet" href="{% static 'assets/vendor/libs/shepherd/shepherd.css' %}">
<!-- Stepper -->
<link rel="stylesheet" href="{% static 'assets/vendor/libs/bs-stepper/bs-stepper.css' %}">
<!-- Search as type style -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" href="{% static 'assets/vendor/libs/bootstrap-select/bootstrap-select.css' %}">
<!-- Custom Style for FlatPicker Calendar -->
<style>
    .light-style .flatpickr-calendar {
    box-shadow: none !important;
    }
</style>
<!-- Custom Style for the Loading Overlay and the Blink -->
<style>
    .loading-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
    }
    .loader {
        border: 8px solid #f3f3f3;
        border-top: 8px solid #3498db;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .highcharts-credits {
        display: none;
    }

    @keyframes blink-border {
        0%   { border-color: #5a8dee; }
        50%  { border-color: transparent; }
        100% { border-color: #5a8dee; }
    }

    .blink-border {
        border: 5px solid #5a8dee;  
        animation: blink-border 0.5s linear infinite;
    }

    #search {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }

    #add-input-field-single {
        width: 100%;
    }

    #add-input-field-grouped {
        width: 100%;
    }

    #input-container input {
        margin: 30px;
    }

    #result-container {
        background-clip: padding-box;
        border-style: solid;
        box-shadow: none;
        border-width: 1px;
        border-color: #e5e5e5;
        border-radius: 12px;
        padding: 10px;
    }

    @keyframes pulseColor {
    0%, 100% {
        color: #5a8dee;
    }
    50% {
        color: #d3dcf7;
    }
    }

    .blink-icon {
        animation: pulseColor 1.5s infinite;
    }

    .light-style .bs-stepper {
        background-clip: padding-box;
        border-style: solid;
        box-shadow: none !important;
        border-width: 1px;
        border-color: #e5e5e5;
        border-radius: 12px;
        background-color: #fff;
    }
</style>
{% endblock %}
{% block content %}
<div class="loading-overlay" id="loading-overlay">
    <div class="loader"></div>
</div>
<div class="d-flex align-items-center py-3 mb-4">
    <i class='bx bx-bullseye bx-lg text-primary me-3'></i>
    <div>
        <h4 class="mb-1">مقایسه کمپین ها</h4>
        <p class="text-muted mb-0">در این قسمت می توانید ابتدا کمپین های مورد نظر را جست و جو و بعد مقایسه کنید</p>
    </div>
</div>
<div class="container">
    <div class="row" id="search-filters" style="margin-bottom: 20px;">
        <!-- Default Wizard -->
        <div class="col-12 mb-4">
            <div class="bs-stepper wizard-numbered mt-2">
            <div class="bs-stepper-header">
                <div class="step" data-target="#account-details">
                <button type="button" class="step-trigger" id="step-one">
                    <span class="bs-stepper-circle">1</span>
                    <span class="bs-stepper-label">
                    <span class="bs-stepper-title">نمایش</span>
                    <span class="bs-stepper-subtitle"> تجمیعی یا تفکیکی</span>
                    </span>
                </button>
                </div>
                <div class="line"></div>
                <div class="step" data-target="#personal-info">
                <button type="button" class="step-trigger" id="step-two"> 
                    <span class="bs-stepper-circle">2</span>
                    <span class="bs-stepper-label">
                    <span class="bs-stepper-title">انتخاب</span>
                    <span class="bs-stepper-subtitle">انتخاب کمپین ها</span>
                    </span>
                </button>
                </div>
            </div>
            <div class="bs-stepper-content">
                <!-- accumulated or separated -->
                <div id="account-details" class="content">
                    <div class="content-header mb-3">
                    <h6 class="mb-1">نمایش</h6>
                    <small>در صورت انتخاب تجمیعی می توانید کمپین ها را به صورت کلی مقابسه کنید و اگر تفکیکی را انتخاب کنید کمپین ها را می توانید به تفکیک شعب انتخاب و مقایسه نمایید.</small>
                    </div>
                    <div class="row g-3">
                    <div class="col-sm-4" style="margin-bottom: 50px; margin-top: 50px;">
                        <label for="displaySelect" class="form-label">نمایش کمپین ها</label>
                        <select id="displaySelect" class="form-select">
                            <option value="">------</option>
                            <option value="aggregate">تجمیعی</option>
                            <option value="separated">تفکیکی</option>
                        </select>
                    </div>
                    <div class="col-12 d-flex justify-content-between">
                        <button class="btn btn-label-secondary btn-prev" disabled>
                        <i class="bx bx-chevron-left bx-sm ms-sm-n2"></i>
                        <span class="d-sm-inline-block d-none">قبلی</span>
                        </button>
                        <button class="btn btn-primary btn-next" id="btn-next">
                        <span class="d-sm-inline-block d-none">بعدی</span>
                        <i class="bx bx-chevron-right bx-sm me-sm-n2"></i>
                        </button>
                    </div>
                    </div>
                </div>
                <!-- Personal Info -->
                <div id="personal-info" class="content">
                    <div class="content-header mb-3">
                    <h6 class="mb-1">انتخاب کمپین</h6>
                    <small>در این قسمت می توانید کمپین ها را برای مقایسه انتخاب کنید.</small>
                    </div>
                    <div class="row g-3">
                    <!-- Name Search -->
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12" id="search-by-name" style="margin-bottom: 10px; display: flex; justify-content: center; align-items: center; flex-direction: column;">
                        <div id="search">
                            <div id="input-container">
                                <div style="width: 100%;">
                                    <p style="width: 100%; height: 0px; color: #f9f9f9;">در این قسمت میتوانید نام کمپین مورد نظر خود را وارد کنید</p>
                                </div>
                            </div>
                            <button id="add-input-field-single" style="display: none;" class="btn btn-success"><i class='bx bx-plus-circle' style="margin-left: 10px;"></i> افزودن کمپین</button>
                            <button id="add-input-field-grouped" style="display: none;" class="btn btn-success"><i class='bx bx-plus-circle' style="margin-left: 10px;"></i> افزودن کمپین</button>
                        </div>
                    </div>
                    <!-- Ignore the select -->
                    <select style="display: none;" class="selectpicker w-auto" id="language" data-style="btn-transparent" data-icon-base="bx" data-tick-icon="bx-check text-white" multiple>
                    </select>
                    <!--/ Ignore the select -->
                    <div class="col-12 d-flex justify-content-between">
                        <button class="btn btn-primary btn-prev" id="btn-previous">
                        <i class="bx bx-chevron-left bx-sm ms-sm-n2"></i>
                        <span class="d-sm-inline-block d-none">قبلی</span>
                        </button>
                        <button class="btn btn-primary btn-md" style="display: none;" type="submit" id="compare-separate-campaign"><i class='bx bx-transfer-alt' style="margin-left: 10px;"></i>مقایسه</button>
                        <button class="btn btn-primary btn-md" style="display: none;" type="submit" id="compare-grouped-campaign"><i class='bx bx-transfer-alt' style="margin-left: 10px;"></i>مقایسه</button>
                    </div>
                    </div>
                </div>
            </div>
            </div>
        </div>
        <!-- /Default Wizard -->
        <!-- Name Search -->
    </div>
</div>
<div id="result-container" class="card" style="padding-bottom: 50px; padding-left: 15px; padding-right: 15px; padding-top: 50px; display: none;">
    <div class="table-responsive text-nowrap">
        <table class="table table-hover" id="result" style=" margin-top: 20px;">
            <thead>
            <tr id="campaign-name">
                <th><i style="margin-left: 10px;" class='bx bx-text'></i> نام کمپین</th>
            </tr>
            </thead>
            <tbody>
            <tr id="campaign-branch">
                <td><i style="margin-left: 10px;" class='bx bx-store'></i> شعبه</td>
            </tr>
            <tr id="campaign-cost">
                <td><i style="margin-left: 10px;" class='bx bx-dollar'></i> هزینه</td>
            </tr>
            <tr id="campaign-type">
                <td><i style="margin-left: 10px;" class='bx bx-purchase-tag'></i> نوع</td>
            </tr>
            <tr id="campaign-avg-traffic">
                <td><i style="margin-left: 10px;" class='bx bx-line-chart'></i> میانگین ترافیک</td>
            </tr>
            <tr id="campaign-avg-sales">
                <td><i style="margin-left: 10px;" class='bx bx-bar-chart-alt'></i> میانگین فروش (تومان)</td>
            </tr>
            <tr id="campaign-avg-invoice">
                <td><i style="margin-left: 10px;" class='bx bx-receipt'></i> میانگین تعداد فاکتور</td>
            </tr>
            <tr id="campaign-avg-conversion">
                <td><i style="margin-left: 10px;" class='bx bx-transfer-alt'></i> میانگین درصد تبدیل (%)</td>
            </tr>
            <tr id="campaign-avg-cart">
                <td><i style="margin-left: 10px;" class='bx bx-box'></i> میانگین محصول</td>
            </tr>
            <tr id="campaign-each-cart">
                <td><i style="margin-left: 10px;" class='bx bx-cart'></i>میانگین تعداد سبد</td>
            </tr>
            <tr id="campaign-avg-value">
                <td><i style="margin-left: 10px;" class='bx bx-log-in'></i>میانگین ارزش ورود (تومان)</td>
            </tr>
            </tbody>
        </table>
    </div>
    <div style="display: flex; justify-content: center; align-items: center;">
        <a class="btn btn-secondary" style="color: white; width: 18%; margin-top: 50px;" onclick="window.location.reload()"><i style="margin-left: 10px;" class='bx bx-arrow-back me-2'></i> بازگشت</a>
    </div>
</div>
{% endblock %}
{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/jalaali-js@1.2.8/dist/jalaali.min.js"></script>
<!-- Gregorian Jalali Conversion Raw JavaScript -->
<script src="{% static 'assets/js/campaign-gregorian-to-jalali-date-convert.js' %}"></script>
<script src="{% static 'assets/js/price-separator.js' %}"></script>
<!-- Add Text Input / Search Form -->
<script>
    function createSingleCampaignSearch() {
        const newSelect = document.createElement("select");
        newSelect.name = "name";
        newSelect.style.width = "90%";
        newSelect.classList.add("form-control");
        newSelect.classList.add("campaign-select-single");
        const inputContainer = document.getElementById("input-container");
        const selectWrapper = document.createElement("div");
        selectWrapper.classList.add("select-wrapper");
        selectWrapper.style.marginTop = "30px";
        selectWrapper.style.marginBottom = "30px";
        selectWrapper.style.width = "100%";
        selectWrapper.style.display = "flex";
        const deleteBtn = document.createElement("button");
        deleteBtn.classList.add("btn");
        deleteBtn.classList.add("btn-danger");
        deleteBtn.style.width = "10%";
        deleteBtn.style.marginRight = "10px";
        const i = document.createElement("i");
        i.classList.add("bx");
        i.classList.add("bx-trash");
        deleteBtn.appendChild(i) 
        selectWrapper.appendChild(newSelect);
        selectWrapper.appendChild(deleteBtn);
        inputContainer.appendChild(selectWrapper);
        $(newSelect).select2({
            placeholder: 'نام کمپین مورد نظر را وارد کنید...',
            ajax: {
                url: '/dashboard/search/single-campaign-search-as-type/',
                dataType: 'json',
                delay: 250,
                data: params => ({ q: params.term }),
                processResults: (data) => ({
                    results: data
                }),
                cache: true
            },
            minimumInputLength: 1,
            width: '100%',
            language: {
                inputTooShort: function (args) {
                    const remaining = args.minimum - args.input.length;
                    return `حداقل ${remaining} کاراکتر دیگر وارد کنید`; 
                }
            }
        });
        $(newSelect).on('select2:select', function (e) {
            selectData = e.params.data;
            const newInput = document.createElement("input");
            newInput.name = "name";
            newInput.classList.add("form-control");
            newInput.classList.add("campaign-form-single");
            newInput.value = selectData.text;
            console.log(newInput.value);
            newInput.style.display = "none";
            const form = document.getElementById("campaign-form");
            form.appendChild(newInput);
        });
    }
    function createGroupedCampaignSearch() {
        const newSelect = document.createElement("select");
        newSelect.name = "name";
        newSelect.style.width = "90%";
        newSelect.classList.add("form-control");
        newSelect.classList.add("campaign-select-grouped");
        const inputContainer = document.getElementById("input-container");
        const selectWrapper = document.createElement("div");
        selectWrapper.classList.add("select-wrapper");
        selectWrapper.style.marginTop = "30px";
        selectWrapper.style.marginBottom = "30px";
        selectWrapper.style.width = "100%";
        selectWrapper.style.display = "flex";
        const deleteBtn = document.createElement("button");
        deleteBtn.classList.add("btn");
        deleteBtn.classList.add("btn-danger");
        deleteBtn.style.width = "10%";
        deleteBtn.style.marginRight = "10px";
        const i = document.createElement("i");
        i.classList.add("bx");
        i.classList.add("bx-trash");
        deleteBtn.appendChild(i) 
        selectWrapper.appendChild(newSelect);
        selectWrapper.appendChild(deleteBtn);
        inputContainer.appendChild(selectWrapper);
        $(newSelect).select2({
            placeholder: 'نام کمپین مورد نظر را وارد کنید...',
            ajax: {
                url: '/dashboard/search/grouped-campaign-search-as-type/',
                dataType: 'json',
                delay: 250,
                data: params => ({ q: params.term }),
                processResults: (data) => ({
                    results: data
                }),
                cache: true
            },
            minimumInputLength: 1,
            width: '100%',
            language: {
                inputTooShort: function (args) {
                    const remaining = args.minimum - args.input.length;
                    return `حداقل ${remaining} کاراکتر دیگر وارد کنید`; 
                }
            }
        });
        $(newSelect).on('select2:select', function (e) {
            selectData = e.params.data;
            const newInput = document.createElement("input");
            newInput.name = "name";
            newInput.classList.add("form-control");
            newInput.classList.add("campaign-select-grouped");
            newInput.value = selectData.text;
            console.log(newInput.value);
            newInput.style.display = "none";
            const form = document.getElementById("grouped-campaign-form");
            form.appendChild(newInput);
        });
    }
    function deleteAllSearchFields() {
        if (document.querySelector(".select-wrapper")) {
         const searchFileds = document.querySelectorAll(".select-wrapper");
         searchFileds.forEach(item => {
            item.remove();
         });
        }
    }
    function deleteAllForms() {
        if (document.querySelector("form")) {
            const forms = document.querySelectorAll("form");
            forms.forEach(form => {
                form.remove();
            });
        }
    }
    // Button Event Listener For Search Field Creation
    document.getElementById("add-input-field-single").addEventListener("click", createSingleCampaignSearch);
    document.getElementById("add-input-field-grouped").addEventListener("click", createGroupedCampaignSearch);
</script>
<script src="https://cdn.jsdelivr.net/npm/jalaali-js/dist/jalaali.min.js"></script>
<!-- JQuery Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- FlatPicker JS (Calendar) -->
<script src="{% static 'assets/vendor/libs/jdate/jdate.js' %}"></script>
<script src="{% static 'assets/vendor/libs/flatpickr/flatpickr-jdate.js' %}"></script>
<script src="{% static 'assets/vendor/libs/moment/moment.js' %}"></script>
<script src="{% static 'assets/vendor/libs/flatpickr/l10n/fa-jdate.js' %}"></script>
<script src="{% static 'assets/js/app-calendar-events.js' %}"></script>
<script src="{% static 'assets/js/app-calendar.js' %}"></script>
<!-- Sweet Alert CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!-- Button Color and Background -->
<script src="{% static 'assets/vendor/libs/shepherd/shepherd.js' %}"></script>
<!-- Search as type functionality -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<!-- Stepper -->
<script src="{% static 'assets/vendor/libs/bs-stepper/bs-stepper.js' %}"></script>
<!-- Accumulated vs Separated Display Toggle Fields -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const fieldsDisplayToggle = document.getElementById("displaySelect");
        const btnNext = document.getElementById("btn-next");
        const stepTwo = document.getElementById("step-two");
        const singleCampaignWrappers = document.querySelectorAll(".single-campaign");
        const groupedCampaignWrappers = document.querySelectorAll(".grouped-campaign");

        function makeNextDisabled() {
            const displaySelectIsEmpty = !fieldsDisplayToggle.value;
            btnNext.disabled = displaySelectIsEmpty;
            stepTwo.disabled = displaySelectIsEmpty;
        }
        
        makeNextDisabled();

        fieldsDisplayToggle.addEventListener("change", makeNextDisabled);

        btnNext.addEventListener("click", () => {
        if (fieldsDisplayToggle.value === "aggregate") {

            // create 2 grouped search fields
            createGroupedCampaignSearch();
            createGroupedCampaignSearch();

            // create a form
            const form = document.createElement("form");
            form.id = "grouped-campaign-form";
            form.method = "get";
            const inputContainer = document.getElementById("input-container");
            inputContainer.appendChild(form);

            document.getElementById("add-input-field-single").style.display = "none";

            document.getElementById("add-input-field-grouped").style.display = "";

            document.getElementById("compare-separate-campaign").style.display = "none";

            document.getElementById("compare-grouped-campaign").style.display = "";

        } 
        if (fieldsDisplayToggle.value  === "separated" ) {

            // create 2 single search fields
            createSingleCampaignSearch();
            createSingleCampaignSearch();

            // create a form
            const form = document.createElement("form");
            form.id = "campaign-form";
            form.method = "get";
            const inputContainer = document.getElementById("input-container");
            inputContainer.appendChild(form);

            document.getElementById("add-input-field-single").style.display = "";
            
            document.getElementById("add-input-field-grouped").style.display = "none";

            document.getElementById("compare-separate-campaign").style.display = "";

            document.getElementById("compare-grouped-campaign").style.display = "none";
        }
        });
        stepTwo.addEventListener("click", () => {
        if (fieldsDisplayToggle.value === "aggregate") {

            // create 2 grouped search fields
            createGroupedCampaignSearch();
            createGroupedCampaignSearch();

            // create a form
            const form = document.createElement("form");
            form.id = "grouped-campaign-form";
            form.method = "get";
            const inputContainer = document.getElementById("input-container");
            inputContainer.appendChild(form);

            document.getElementById("add-input-field-single").style.display = "none";

            document.getElementById("add-input-field-grouped").style.display = "";

            document.getElementById("compare-separate-campaign").style.display = "none";

            document.getElementById("compare-grouped-campaign").style.display = "";

        } 
        if (fieldsDisplayToggle.value  === "separated" ) {

            // create 2 single search fields
            createSingleCampaignSearch();
            createSingleCampaignSearch();

            // create a form
            const form = document.createElement("form");
            form.id = "campaign-form";
            form.method = "get";
            const inputContainer = document.getElementById("input-container");
            inputContainer.appendChild(form);

            document.getElementById("add-input-field-single").style.display = "";
            
            document.getElementById("add-input-field-grouped").style.display = "none";

            document.getElementById("compare-separate-campaign").style.display = "";

            document.getElementById("compare-grouped-campaign").style.display = "none";
        }
        });
    });
</script>
<script src="{% static 'assets/js/form-wizard-numbered.js' %}"></script>
<!-- Comparison Form Event Listener -->
<script>
    const compareSeparateCampaign = document.getElementById("compare-separate-campaign");
    const compareGroupedCampaign = document.getElementById("compare-grouped-campaign");

    // Table Items
    const campaignName = document.getElementById("campaign-name");
    const campaignBranch = document.getElementById("campaign-branch");
    const campaignCost = document.getElementById("campaign-cost");
    const campaignType = document.getElementById("campaign-type");
    const campaignAvgTraffic = document.getElementById("campaign-avg-traffic");
    const campaignAvgSales = document.getElementById("campaign-avg-sales");
    const campaignAvgInvoice = document.getElementById("campaign-avg-invoice");
    const campaignAvgConversion = document.getElementById("campaign-avg-conversion");
    const campaignAvgCart = document.getElementById("campaign-avg-cart");
    const campaignAvgValue = document.getElementById("campaign-avg-value");
    const campaignEachCart = document.getElementById("campaign-each-cart");

    // Search Fields
    const searchFields = document.getElementById("search-filters");
    // Result Container
    const resultContainer = document.getElementById("result-container");

    compareSeparateCampaign.addEventListener("click", () => {
        // Event Listener on form for Separate Campaign Comparison
        $("#campaign-form").on("submit", function (e) {
        e.preventDefault();
        const form = document.querySelector("#campaign-form");
        const formData = new FormData(form);
        const campaign = formData.getAll("name");
        const loadingOverlay = document.getElementById("loading-overlay");
        loadingOverlay.style.display = "flex";
        if (campaign.length <= 1) {
            Swal.fire({
            icon: "error",
            title: "خطا",
            text: "برای مقایسه باید حداقل دو کمپین انتخاب شوند.",
            confirmButtonColor: '#5a8dee',
            confirmButtonText: 'بستن' 
            });
            loadingOverlay.style.display = "none";
            return;
        }
        // hide search fields if successful
        searchFields.style.display = "none";
        // show the result
        resultContainer.style.display = "";
        $.ajax({
            url: "/api/single-campaigns-comparison",
            data: {
                "campaign": campaign,
            },
            traditional: true,
            method: "GET",
            success: function (data) {
                data.forEach(campaign => {
                // campaign name
                const nameTd = document.createElement("td");
                nameTd.innerText = `${campaign.name}`;
                campaignName.appendChild(nameTd);
                // campaign branch
                const branchNameTd = document.createElement("td");
                branchNameTd.innerText = `${campaign.branch_name}`;
                campaignBranch.appendChild(branchNameTd);
                // campaign cost
                const costTd = document.createElement("td");
                costTd.innerText = `${campaign.cost}`;
                campaignCost.appendChild(costTd);
                // campaign type
                const typeTd = document.createElement("td");
                typeTd.innerText = `${campaign.campaign_type}`;
                campaignType.appendChild(typeTd);
                // average traffic
                const peopleCountingAvgTd = document.createElement("td");
                peopleCountingAvgTd.innerText = `${campaign.people_counting_avg}`;
                campaignAvgTraffic.appendChild(peopleCountingAvgTd);
                // average sales
                const invoiceAmountAvgTd = document.createElement("td");
                invoiceAmountAvgTd.classList.add("cprice");
                invoiceAmountAvgTd.innerText = `${campaign.invoice_amount_avg}`;
                campaignAvgSales.appendChild(invoiceAmountAvgTd);
                // average invoice
                const campaignAvgInvoiceTd = document.createElement("td");
                campaignAvgInvoiceTd.innerText = `${campaign.invoice_number_avg}`;
                campaignAvgInvoice.append(campaignAvgInvoiceTd);
                // average conversion rate
                const conversionTd = document.createElement("td");
                conversionTd.classList.add("cprice");
                conversionTd.innerText = `${campaign.conversion_rate}`;
                campaignAvgConversion.appendChild(conversionTd);
                // average product
                const productTd = document.createElement("td");
                productTd.innerText = `${campaign.product}`;
                campaignAvgCart.appendChild(productTd);
                // average cart
                const cartTd = document.createElement("td");
                cartTd.innerText = `${campaign.cart}`;
                campaignEachCart.appendChild(cartTd);
                // value per person
                const valueTd = document.createElement("td");
                valueTd.classList.add("cprice");
                valueTd.innerText = `${campaign.value_per_visitor}`;
                campaignAvgValue.appendChild(valueTd);

                loadingOverlay.style.display = "none";
                window.scrollTo({
                    top: document.body.scrollHeight,
                    behavior: "smooth"
                });
                });
            },
            error: function (xhr) {
                console.error("Error loading data");
                loadingOverlay.style.display = "none";
            }
        });
        function priceSeparator() {
            document.querySelectorAll(".cprice").forEach(el => {
                const rowPrice = Number(el.innerHTML.trim());
                el.innerHTML = rowPrice.toLocaleString("fa-IR");
            });
        }
        setTimeout(priceSeparator, 500);
        document.querySelector("thead").classList.add("blink-border");
        setTimeout(() => {document.querySelector("thead").classList.remove("blink-border")}, 2000);
    });
    $("#campaign-form").submit();
    });
    compareGroupedCampaign.addEventListener("click", () => {
        // Event Listener on form for Grouped Campaign Comparison
        $("#grouped-campaign-form").on("submit", function (e) {
        e.preventDefault();
        const form = document.querySelector("#grouped-campaign-form");
        const formData = new FormData(form);
        const campaign = formData.getAll("name");
        console.log(campaign)
        const loadingOverlay = document.getElementById("loading-overlay");
        loadingOverlay.style.display = "flex";
        if (campaign.length <= 1) {
            Swal.fire({
            icon: "error",
            title: "خطا",
            text: "برای مقایسه باید حداقل دو کمپین انتخاب شوند.",
            confirmButtonColor: '#5a8dee',
            confirmButtonText: 'بستن' 
            });
            loadingOverlay.style.display = "none";
            return;
        }
        // hide search fields if successful
        searchFields.style.display = "none";
        // show the result
        resultContainer.style.display = "";
        $.ajax({
            url: "/api/grouped-campaigns-comparison",
            data: {
                "grouped-campaign": campaign,
            },
            traditional: true,
            method: "GET",
            success: function (data) {
                data.forEach(campaign => {
                // campaign name
                const nameTd = document.createElement("td");
                nameTd.innerText = `${campaign.campaign_name}`;
                campaignName.appendChild(nameTd);
                // campaign branch
                const branchNameTd = document.createElement("td");
                branchNameTd.innerText = `شعب منتخب`;
                branchNameTd.title = `${campaign.branch_names}`;
                campaignBranch.appendChild(branchNameTd);
                // campaign cost
                const costTd = document.createElement("td");
                costTd.innerText = `${campaign.campaign_cost}`;
                campaignCost.appendChild(costTd);
                // campaign type
                const typeTd = document.createElement("td");
                typeTd.innerText = `${campaign.campaign_type}`;
                campaignType.appendChild(typeTd);
                // average traffic
                const peopleCountingAvgTd = document.createElement("td");
                peopleCountingAvgTd.innerText = `${campaign.people_counting_avg}`;
                campaignAvgTraffic.appendChild(peopleCountingAvgTd);
                // average sales
                const invoiceAmountAvgTd = document.createElement("td");
                invoiceAmountAvgTd.classList.add("cprice");
                invoiceAmountAvgTd.innerText = `${campaign.invoice_amount_avg}`;
                campaignAvgSales.appendChild(invoiceAmountAvgTd);
                // average invoice
                const campaignAvgInvoiceTd = document.createElement("td");
                campaignAvgInvoiceTd.innerText = `${campaign.invoice_number_avg}`;
                campaignAvgInvoice.append(campaignAvgInvoiceTd);
                // average conversion rate
                const conversionTd = document.createElement("td");
                conversionTd.classList.add("cprice");
                conversionTd.innerText = `${campaign.conversion_rate}`;
                campaignAvgConversion.appendChild(conversionTd);
                // average product
                const productTd = document.createElement("td");
                productTd.innerText = `${campaign.product}`;
                campaignAvgCart.appendChild(productTd);
                // average cart
                const cartTd = document.createElement("td");
                cartTd.innerText = `${campaign.cart}`;
                campaignEachCart.appendChild(cartTd);
                // value per person
                const valueTd = document.createElement("td");
                valueTd.classList.add("cprice");
                valueTd.innerText = `${campaign.value_per_visitor}`;
                campaignAvgValue.appendChild(valueTd);
                
                loadingOverlay.style.display = "none";
                window.scrollTo({
                    top: document.body.scrollHeight,
                    behavior: "smooth"
                });
                });
            },
            error: function (xhr) {
                console.error("Error loading data");
                loadingOverlay.style.display = "none";
            }
        });
        function priceSeparator() {
            document.querySelectorAll(".cprice").forEach(el => {
                const rowPrice = Number(el.innerHTML.trim());
                el.innerHTML = rowPrice.toLocaleString("fa-IR");
            });
        }
        setTimeout(priceSeparator, 500);
        document.querySelector("thead").classList.add("blink-border");
        setTimeout(() => {document.querySelector("thead").classList.remove("blink-border")}, 2000);
    });
    $("#grouped-campaign-form").submit();
    });
</script>
<!-- Delete Element -->
<script>
    const btnPrevious = document.querySelector("#btn-previous");
    btnPrevious.addEventListener("click", () => {
        deleteAllSearchFields();
        deleteAllForms();
    });
    const stepOne = document.querySelector("#step-one");
    stepOne.addEventListener("click", () => {
        deleteAllSearchFields();
        deleteAllForms();
    });
    document.getElementById('input-container').addEventListener('click', function(e) {
        if (e.target.closest('.btn-danger')) {
            const wrapper = e.target.closest('.select-wrapper');
            if (!wrapper) return;

            // Get the select inside this wrapper
            const select = wrapper.querySelector('select');

            // Get the currently selected value
            const selectValue = $(select).val();
            const selectText  = $(select).find('option:selected').text(); 

            const inputs = document.querySelectorAll('input');
            if (inputs) {
                inputs.forEach(input => {
                    if (input.value === selectText) {
                        input.remove();
                    }
                });
            }

            const input = wrapper.querySelector('input');
            if (input) input.remove();

            wrapper.remove();
        }
    });
</script>
{% endblock %}