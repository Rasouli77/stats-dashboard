{% extends 'base.html' %}
{% load static %}
{% block title %}
	تحلیل آمار کمپین
{% endblock %}
{% block meta_description %}
	تحلیل آمار کمپین
{% endblock %}
{% block extra_css %}
    <!-- Style for Calendar, FlatPicker and Toastr -->
    <link rel="stylesheet" href="{% static 'assets/vendor/libs/fullcalendar/fullcalendar.css' %}">
    <link rel="stylesheet" href="{% static 'assets/vendor/libs/flatpickr/flatpickr.css' %}">
    <link rel="stylesheet" href="{% static 'assets/vendor/css/pages/app-calendar.css' %}">
    <link rel="stylesheet" href="{% static 'assets/vendor/libs/toastr/toastr.css' %}" />
    <!-- Custom Style for FlatPicker Calendar -->
    <style>
        .light-style .flatpickr-calendar {
        box-shadow: none !important;
        }
    </style>
    <!-- Custom Style for the Loading Overlay -->
    <style>
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .loader {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .highcharts-credits {
          display: none;
        }
    </style>
{% endblock %}
{% block content %}
    <h3>تحلیل آمار کمپین</h3>
    <div class="loading-overlay" id="loading-overlay">
        <div class="loader"></div>
    </div>
    <div class="calendar-container">
        <div class="container">
            <div class="row">
                <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12">
                    <div class="card-body">
                      <h6 class="text-muted text-uppercase">درباره کمپین</h6>
                      <ul class="list-unstyled mb-4 mt-3">
                        <li class="d-flex align-items-center mb-3">
                          <i class="menu-icon tf-icons bx bx-calendar" style="margin-left: 0px;"></i><span class="fw-semibold mx-2">نام کمپین:</span>
                          <span>{{ campaign.name }}</span>
                        </li>
                        <li class="d-flex align-items-center mb-3">
                          <i class="bx bx-star"></i><span class="fw-semibold mx-2">نوع کمپین:</span>
                          <span>{{ campaign.campaign_type}}</span>
                        </li>
                        <li class="d-flex align-items-center mb-3">
                          <i class="bx bx-flag"></i><span class="fw-semibold mx-2">شعبه:</span>
                          <span>{{ campaign.branch.name }}</span>
                        </li>
                      </ul>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="demo-inline-spacing mt-3">
                    <div class="tab-content px-0 pt-2">
                        <!-- entries -->
                        <div id="container" style="width: 100%; height: 400px; margin-top: 45px;"></div>
                        <!-- sales -->
                        <div id="second-container" style="width: 100%; height: 400px; margin-top: 45px;"></div>
                        <!-- counts -->
                         <div id="third-container" style="width: 100%; height: 400px; margin-top: 45px;"></div>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/jalaali-js/dist/jalaali.min.js"></script>
<!-- JQuery and Toastr Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'assets/vendor/libs/toastr/toastr.js' %}"></script>
<script src="{% static 'assets/js/ui-toasts.js' %}"></script>
<!-- HighChart Chart Paint (Aggregation) Raw JavaScript / Invoices Paint Display Raw Javascript -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const rawCategories = JSON.parse('{{ dates|safe }}');  
        const categories = rawCategories.map(dateStr => {
            const date = new Date(dateStr);
            return date.toLocaleDateString('fa-IR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
        });
        const entry_totals = JSON.parse('{{ entry_totals|safe }}');
        const total_amount = JSON.parse('{{ total_amount|safe }}');
        const total_items = JSON.parse('{{ total_items|safe }}');
        console.log(rawCategories, entry_totals, total_amount, total_items)
        lineChart = Highcharts.chart('container', {
        chart: {
            type: 'line',
            backgroundColor: '#f9f9f9',
            style: {
                fontFamily: 'tahoma',
                fontSize: '20px'
            }
        },
        title: {
            text: "ترافیک",
            style: {
                fontSize: '25px',
                color: '#333'
            }
        },
        xAxis: {
            categories: categories,
            title: {
                text: "تاریخ",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold'
                }
            }
        },
        yAxis: {
            title: {
                text: "ترافیک",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold'
                }
            }
        },
        series: [
            {
                name: "ترافیک",
                data: entry_totals
            }
        ]
    });

    secondLineChart = Highcharts.chart('second-container', {
        chart: {
            type: 'line',
            backgroundColor: '#f9f9f9',
            style: {
                fontFamily: 'tahoma',
                fontSize: '20px'
            }
        },
        title: {
            text: "فروش",
            style: {
                fontSize: '25px',
                color: '#333'
            }
        },
        xAxis: {
            categories: categories,
            title: {
                text: "تاریخ",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold'
                }
            }
        },
        yAxis: {
            title: {
                text: "فروش",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold'
                }
            }
        },
        series: [
            {
                name: "فروش",
                data: total_amount
            }
        ]
    });

    thirdLineChart = Highcharts.chart('third-container', {
        chart: {
            type: 'line',
            backgroundColor: '#f9f9f9',
            style: {
                fontFamily: 'tahoma',
                fontSize: '20px'
            }
        },
        title: {
            text: "تعداد فاکتور",
            style: {
                fontSize: '25px',
                color: '#333'
            }
        },
        xAxis: {
            categories: categories,
            title: {
                text: "تاریخ",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold'
                }
            }
        },
        yAxis: {
            title: {
                text: "تعداد فاکتور",
                style: {
                    fontSize: '20px',
                    fontWeight: 'bold'
                }
            }
        },
        series: [
            {
                name: "تعداد فاکتور",
                data: total_items
            }
        ]
    });
    });
</script>
<!-- HighChart JS -->
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>
<!-- FlatPicker JS (Calendar) -->
<script src="{% static 'assets/vendor/libs/jdate/jdate.js' %}"></script>
<script src="{% static 'assets/vendor/libs/flatpickr/flatpickr-jdate.js' %}"></script>
<script src="{% static 'assets/vendor/libs/moment/moment.js' %}"></script>
<script src="{% static 'assets/vendor/libs/flatpickr/l10n/fa-jdate.js' %}"></script>
<script src="{% static 'assets/js/app-calendar-events.js' %}"></script>
<script src="{% static 'assets/js/app-calendar.js' %}"></script>
<!-- FlatPicker (JS Calendar) Persian Configuration / Form Checks -->
<script src="{% static 'assets/js/persian-flatpicker-and-form-checks.js' %}"></script>
<!-- Gregorian Jalali Conversion Raw JavaScript -->
<script src="{% static 'assets/js/campaign-gregorian-to-jalali-date-convert.js' %}"></script>
{% endblock %}




